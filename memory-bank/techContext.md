# Tech Context

_This document lists the technologies used, development setup, technical constraints, dependencies, and tool usage patterns._ 

## Build System and Dependency Management
- **Nix Flakes**: For reproducible builds (`flake.nix`).

## Core Technologies and Languages
- **Haskell**: Primary backend language.
- **PureScript**: Likely for frontend.
- **Nix**: Build system language.
- **YAML**: For Namma DSL.
- **Dhall**: For configuration.
- **GraphQL**: `rider-app` uses `morpheus-graphql-client`.

## Key Data Stores & Messaging Systems
- **PostgreSQL**: Persistent store (Beam ORM).
- **Redis**: Caching/transient data (`hedis`), likely used for OTPs, `RegistrationToken`, rate limiting, distributed locks, and potentially geospatial queries for nearby drivers.
- **Apache Kafka**: Event streaming.

## Key Development Tools and Methodologies
- **Namma DSL (`alchemist`)**: YAML-based DSL for API/storage, `run-generator` for code-gen.
- **`beckn-cli`**: Load testing (K6), Beckn key manage
ment.
- **Service Templating (`example-service`)**.
- **Mocking Framework**: `mocks/google`, `mocks/rider-platform`, `mock-registry`.
- **Monitoring**: Prometheus.

## Key Haskell Libraries & Frameworks (examples from various services):
- **Core Rider Application (`rider-app` from `Backend/app/rider-platform/rider-app/Main/`):
    - **API/Storage Definition**: Namma DSL for many Action modules.
    - **API Implementation**: Servant, with modular API structure.
        - `API.UI.Registration`: Handles OTP/signature/token-based user authentication.
            - **Endpoints**: `/v2/auth` (initiate with OTP), `/v2/auth/signature` (initiate with client signature via `x-sdk-authorization`), `/v2/auth/{authId}/verify` (verify OTP), `/v2/auth/otp/{authId}/resend` (resend OTP), `/v2/auth/logout` (logout).
            - **Process**: Creates `RegistrationToken` (stores OTP, expiry, user ID, likely in DB/Redis). Validates OTP against token. Generates session token (Passetto via `Tools.Auth`) on successful verification.
            - **Client Context**: Processes headers like `x-bundle-version`, `x-client-version`, `x-config-version`, `x-rn-version`, `x-device`, `x-forwarded-for`.
            - **Delegation**: Core logic in `Domain.Action.UI.Registration`.
            - **External Calls (Implied)**: SMS gateway for OTP dispatch (e.g., via `external` library).
        - `API.UI.Search`: Manages standard and multimodal ride searches.
            - **Endpoints**: `POST /v2/rideSearch` (standard taxi/on-demand), `POST /v2/multimodalSearch`.
            - **Request Data**: `DSearch.SearchReq` (origin, destination, time, preferences). Processes client context headers (versions, device, client ID, IMEI for multimodal).
            - **Core Logic Delegation**: Initial search request creation via `Domain.Action.UI.Search.search` (persists `SearchRequest.SearchRequest` entity).
            - **Standard Search Specifics**: 
                - Uses `TaxiACL.buildSearchReqV2` for Beckn V2 request payload.
                - Asynchronously calls BPPs via `CallBPP.searchV2`.
                - Conditional logic for cancelling previous active searches (interacts with `Estimate`, `Booking` entities, `API.UI.Select.cancelSearch'`, `Domain.Action.UI.Cancel`).
            - **Multimodal Search Specifics**: 
                - Orchestrates calls to external multimodal routing engines (via `Kernel.External.MultiModal.Interface.getTransitRoutes`) and potentially direct FRFS lookups (`JMU.getSingleModeRouteDetails`).
                - Uses `Lib.JourneyModule` (`JM.init`, `JM.filterTransitRoutes`, `JMU.*`) for processing routes into `Journey.Journey` entities and `DQuote.JourneyData` for API responses.
                - Integrates with CRIS for subway legs via `ExternalBPP.ExternalAPI.CallAPI.buildStations` and `CRISRouteFare.getRouteFare` (using `CRISFareRequest` which includes encrypted IMEI, mobile number, session ID).
                - Handles user preferences (`DMC.getMultimodalUserPreferences`) and platform configs (`DRC.RiderConfig`, `DIBC.IntegratedBPPConfig`).
                - May initiate first journey leg (`DMC.postMultimodalInitiate`).
            - **Supporting Technologies**: Redis for rate limiting (`Kernel.Storage.Hedis.slidingWindowLimiter`), `Kernel.External.Encryption` for IMEI, `EulerHS.Prelude.fork` for async operations, `Kernel.Tools.Metrics.CoreMetrics` and `JMU.measureLatency` for performance.
        - `API.UI.Quote`: Fetches aggregated ride quotes post-search.
            - **Endpoint**: `GET /v2/rideSearch/{searchId}/results` (token authenticated).
            - **Request Params**: `searchId` (path), `allowMultiple` (optional query Bool).
            - **Functionality**: Delegates to `Domain.Action.UI.Quote.getQuotes`.
            - **Core Logic**: `Domain.Action.UI.Quote.getQuotes` retrieves stored quotes/offers (e.g., `Estimate` entities or processed `Journey` data) associated with the `searchId` from the database/cache. It may filter/rank based on `allowMultiple` and ensures only valid (non-expired) quotes are returned.
            - **Response**: `DQuote.GetQuotesRes` containing a list of `DQuote.OfferRes` (provider, vehicle, fare, ETA, `estimateId`).
            - **Data Models**: `SSR.SearchRequest` (context), `Estimate.Estimate` (implied storage for BPP quotes), `DQuote.GetQuotesRes`, `DQuote.OfferRes`.
        - `API.UI.Select`: Handles user's selection of a quote, sends Beckn "select" to BPP.
        - `API.UI.Confirm`: Manages user's confirmation of a selected quote (Beckn "init" phase).
        - `API.UI.Booking`: Handles final ride booking (Beckn "confirm" phase) and post-booking management.
        - `API.Action.UI.RidePayment`: Manages user payment methods, payment intent creation, and ride-specific payment settings like tips.
        - `API.UI.Payment`: Handles creation of payment orders for rides and status polling, using `Lib.Payment.API` structure.
        - `API.UI.Ride`: Provides endpoints for active ride management and information.
        - `API.UI.Rating`: Handles post-ride feedback (ratings, Know Your Driver).
        - `API.UI.FeedbackForm`: Handles detailed, structured feedback.
        - `API.Action.UI.Invoice` (mounted in `API.UI.hs` context): Handles retrieval of ride invoices.
        - `API.Action.UI.PriceBreakup` (mounted in `API.UI.hs` context): Handles retrieval of fare breakdowns.
        - `API.UI.Profile`: Manages user profile information including emergency contacts.
        - `API.Action.UI.Sos` (mounted in `API.UI.hs` context, Namma DSL generated): Handles core SOS functionalities.
            - `POST /v2/sos/create`: Creates an SOS alert. Delegates to `Domain.Action.UI.Sos.postSosCreate`.
            - `GET /v2/sos/getDetails/{rideId}`: Fetches SOS details. Delegates to `Domain.Action.UI.Sos.getSosGetDetails`.
            - `POST /v2/sos/{sosId}/status`: Updates SOS status. Delegates to `Domain.Action.UI.Sos.postSosStatus`.
            - `POST /v2/sos/{sosId}/markRideAsSafe`: Marks ride as safe. Delegates to `Domain.Action.UI.Sos.postSosMarkRideAsSafe`.
            - `POST /v2/sos/callPolice`: Initiates call police action. Delegates to `Domain.Action.UI.Sos.postSosCallPolice`.
            - `GET /sos/IvrOutcome`: Unauthenticated webhook for IVR call outcomes. Delegates to `Domain.Action.UI.Sos.getSosIvrOutcome`.
            - `POST /v2/sos/createMockSos`: Creates a mock SOS for testing.
        - `API.UI.Sos` (actual source file in `src/API/UI/Sos.hs`):
            - `POST /v2/sos/{sosId}/upload`: Handles SOS media (video) upload using `MultipartForm`. Delegates to `Domain.Action.UI.Sos.uploadMedia`.
        - `API.UI.Issue` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/Issue.hs`):
            - **Shared Component**: Leverages API structure from `IssueManagement.API.UI.Issue` (`IA.IssueAPI`).
            - **Adapter**: Uses `customerIssueHandle` to provide `rider-app` specific implementations for data fetching (e.g., `castPersonById`, `castRideById` using `Storage.Queries.*`, `getRideInfo` with Redis caching) and actions (e.g., `Tools.Ticket` for external ticketing, `SharedLogic.CallBPPInternal` for internal reporting, `Domain.Action.UI.Sos.sendUnattendedSosTicketAlert`).
            - **Endpoints**: Exposes functionality for creating, listing, viewing, updating (including status, customer responses, ratings), and deleting issue reports; managing media attachments; and fetching dynamic issue categories/options.
            - **Beckn IGM**: 
                - Constructs Beckn IGM `issue` payloads using `Beckn.ACL.IGM.Issue.buildIssueReq` (validating subcategories against `IGM.Enums.Spec.*`).
                - Sends IGM `issue` messages (create/update) to BPPs via `SharedLogic.CallIGMBPP.issue` (asynchronously).
                - Constructs and sends Beckn `issue_status` polling requests via `SharedLogic.CallIGMBPP.issueStatus` (for `GET /v2/issue/igm/status` admin endpoint).
                - Manages local `DIGM.IGMIssue` entities (persisted via `QIGM.*` queries) and general `IssueReport` entities.
            - **Data Models**: Uses types from `IssueManagement.Common.UI.Issue`, `IssueManagement.Domain.Types.Issue.*`, and transforms `rider-app` entities for compatibility.
        - `API.UI.Support` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/Support.hs`):
            - **Endpoints & Purpose**:
                - `POST /v2/support/sendIssue`: For submitting general issues (`DSupport.SendIssueReq`), returns `DSupport.SendIssueRes`.
                - `POST /v2/support/callbackRequest`: For users to request a callback from support, returns `APISuccess.APISuccess`.
                - `POST /v2/support/safetyCheckSupport`: For submitting support requests related to safety checks (`DSupport.SafetyCheckSupportReq`), returns `DSupport.SendIssueRes`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: All handlers delegate core logic to respective functions in `Domain.Action.UI.Support` (e.g., `DSupport.sendIssue`, `DSupport.callbackRequest`, `DSupport.safetyCheckSupport`).
        - `API.UI.Cancel` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/Cancel.hs`):
            - **Endpoints & Purpose**:
                - `POST /v2/rideBooking/{rideBookingId}/softCancel`: Initiates a soft cancellation.
                - `POST /v2/rideBooking/{rideBookingId}/cancel`: Initiates a hard cancellation, takes `DCancel.CancelReq` (with reason, `reallocate` flag).
                - `GET /v2/rideBooking/cancellationDues`: Fetches potential cancellation fees (`DCancel.CancellationDuesDetailsRes`), `rideBookingId` is optional.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: All handlers delegate core logic to respective functions in `Domain.Action.UI.Cancel` (e.g., `DCancel.softCancel`, `DCancel.cancel`, `DCancel.getCancellationDuesDetails`).
            - **Beckn Integration**: For cancellations, constructs Beckn cancel request (`ACL.buildCancelReqV2`) and sends to BPP via `CallBPP.cancelV2` (asynchronously with retry).
            - **Database Interaction**: Involves fetching `Booking` and `Ride` details to process cancellations.
        - `API.Action.UI.TriggerFCM` (mounted in `API.UI.hs` context, Namma DSL generated from `src-read-only/API/Action/UI/TriggerFCM.hs`):
            - **Endpoint & Purpose**: `POST /v2/triggerFCM/message` for sending targeted FCM push notifications to riders.
            - **Request**: `API.Types.UI.TriggerFCM.TriggerFcmReq` (includes target user/device, title, body, data payload).
            - **Authentication**: Requires `TokenAuth` (likely for internal service-to-service calls or admin-initiated actions, not direct user calls to trigger messages to themselves).
            - **Delegation**: Handler `postTriggerFCMMessage` delegates to `Domain.Action.UI.TriggerFCM.postTriggerFCMMessage`.
            - **FCM Dispatch**: The domain action is responsible for constructing the FCM payload and using an FCM client to send the notification. This client could be a direct HTTP client to FCM servers or an abstraction via the `external` library (e.g., using AWS SNS which can fan out to FCM, APNS, etc.). Requires FCM server key/credentials configured in the environment.
        - `API.Beckn` and `API.BecknAPIV2` (located in `Backend/app/rider-platform/rider-app/Main/src/API/Beckn.hs`):
            - **Purpose**: Serve as the BAP listener for asynchronous callbacks from BPPs/Gateway.
            - **Endpoints**: Define routes like `/cab/v1/...` and `/beckn/cab/v1/{merchantId}/...` for various Beckn `on_action` callbacks.
            - **Security**: All callback endpoints are protected by `SignatureAuth` (from `Kernel.Utils.Servant.SignatureAuth`) verifying BPP/Gateway message signatures.
            - **Modular Delegation**: Each specific `on_action` is routed to its dedicated handler module.
            - **Specific Callback Handlers**:
                - `API.Beckn.OnSearch` (handler for `on_search`):
                    - **Input**: Beckn `OnSearch.OnSearchReqV2`.
                    - **Processing**: Validates context against original `SearchRequest`. Transforms payload to internal `DOnSearch.DOnSearchReq` via `TaxiACL.buildOnSearchReqV2`. Uses Redis locks (`onSearchLockKey`, `onSearchProcessingLockKey`) for idempotency. Validates offers via `Domain.Action.Beckn.OnSearch.validateRequest`. Asynchronously persists validated offers as `Estimate` entities via `Domain.Action.Beckn.OnSearch.onSearch`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnSelect` (handler for `on_select`):
                    - **Input**: Beckn `OnSelect.OnSelectReqV2`.
                    - **Processing**: Validates context. Transforms payload to internal `DOnSelect.DOnSelectReq` via `Beckn.ACL.OnSelect.ACL.buildOnSelectReqV2`. Uses Redis locks (`onSelectLockKey`, `onSelectProcessingLockKey`) for idempotency. Validates BPP's confirmed offer against original selection via `Domain.Action.Beckn.OnSelect.validateRequest`. Asynchronously updates the `Estimate` entity with confirmed details via `Domain.Action.Beckn.OnSelect.onSelect`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnInit` (handler for `on_init`):
                    - **Input**: Beckn `OnInit.OnInitReqV2`.
                    - **Processing**: Validates context. Transforms payload via `TaxiACL.buildOnInitReqV2` into a sum type `DOnInit.DOnInitReq` (then `DOnInit.ValidatedOnInitReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onInitLockKey`, `onInitProcessingLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnInit.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnInit.onInit`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnConfirm` (handler for `on_confirm`):
                    - **Input**: Beckn `OnConfirm.OnConfirmReqV2`.
                    - **Processing**: Validates context. Transforms payload via `TaxiACL.buildConfirmReqV2` into a sum type `DOnConfirm.DOnConfirmReq` (then `DOnConfirm.ValidatedOnConfirmReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onConfirmLockKey`, `onConfirmProcessingLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnConfirm.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnConfirm.onConfirm`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnStatus` (handler for `on_status`):
                    - **Input**: Beckn `OnStatus.OnStatusReqV2`.
                    - **Processing**: Validates context. Transforms payload via `TaxiACL.buildOnStatusReqV2` into a sum type `DOnStatus.DOnStatusReq` (then `DOnStatus.ValidatedOnStatusReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onStatusLockKey`, `onStatusProcessingLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnStatus.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnStatus.onStatus`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnTrack` (handler for `on_track`):
                    - **Input**: Beckn `OnTrack.OnTrackReqV2`.
                    - **Processing**: Validates context. Transforms payload via `TaxiACL.buildOnTrackReqV2` into a sum type `DOnTrack.DOnTrackReq` (then `DOnTrack.ValidatedOnTrackReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onTrackLockKey`, `onTrackProcessingLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnTrack.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnTrack.onTrack`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnCancel` (handler for `on_cancel`):
                    - **Input**: Beckn `OnCancel.OnCancelReqV2`.
                    - **Processing**: Validates context. Transforms payload via `TaxiACL.buildOnCancelReqV2` into a sum type `DOnCancel.DOnCancelReq` (then `DOnCancel.ValidatedOnCancelReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onCancelLockKey`, `onCancelProcessingLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnCancel.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnCancel.onCancel`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
                - `API.Beckn.OnUpdate` (handler for `on_update`):
                    - **Input**: Beckn `OnUpdate.OnUpdateReqV2`.
                    - **Processing**: Validates context. Transforms payload via `Beckn.ACL.OnUpdate.ACL.buildOnUpdateReqV2` into a sum type `DOnUpdate.DOnUpdateReq` (then `DOnUpdate.ValidatedOnUpdateReq` with constructors like `OUValidatedRideAssignedReq`, `OUValidatedRideCompletedReq`, `OUValidatedBookingCancelledReq`, `OUValidatedFarePaidReq`, `OUValidatedEditDestConfirmUpdateReq`, etc.). Uses Redis locks (`onUpdateLockKey`, `onUpdateProcessngLockKey`) for idempotency. Validates specific update type via `Domain.Action.Beckn.OnUpdate.validateRequest`. Asynchronously applies the update to `Booking`/`Ride` entities using a pattern match in `Domain.Action.Beckn.OnUpdate.onUpdate`. Logs to `TransactionLogs.pushLogs`.
                    - **Response to BPP**: `Ack`.
        - `API.UI.Call` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/Call.hs`):
            - **Purpose**: Manages in-app voice calls (rider-driver), likely via Exotel.
            - **API Groups**:
                - `BackendBasedCallAPI` (rider initiates call via `rider-app`):
                    - `POST /v2/ride/{rideId}/call/driver`: Rider initiates call to driver. Returns `DCall.CallRes`. Delegates to `Domain.Action.UI.Call.initiateCallToDriver`.
                    - `GET /v2/ride/{rideId}/call/{callId}/status`: Rider polls for status of backend-initiated call. Returns `DCall.GetCallStatusRes`. Delegates to `Domain.Action.UI.Call.getCallStatus`.
                    - `POST /v2/ride/call/statusCallback`: Webhook for telephony provider to post status updates for backend-initiated calls (`DCall.CallCallbackReq`). Returns `DCall.CallCallbackRes`. Delegates to `Domain.Action.UI.Call.callStatusCallback`.
                - `FrontendBasedCallAPI` (telephony provider/IVR drives flow):
                    - `GET /v2/exotel/call/driver/number`: Exotel fetches driver number. Query params include `CallSid`, `CallFrom`, `CallTo`, `CallStatus` (Exotel specific). Returns `DCall.GetDriverMobileNumberResp`. Delegates to `Domain.Action.UI.Call.getDriverMobileNumber`.
                    - `GET /v2/exotel/call/alternate/driver/number`: Similar, for alternate driver number.
                    - `GET /v2/exotel/call/statusCallback`: Exotel posts final call status directly. Query params include `CallSid`, `DialCallStatus`, `RecordingUrl`. Returns `DCall.CallCallbackRes`. Delegates to `Domain.Action.UI.Call.directCallStatusCallback`.
            - **Authentication**: Backend-initiated call endpoints require `TokenAuth`. Exotel-facing callbacks are unauthenticated but rely on data in query params for context.
            - **Key Data Types**: `DCall.CallStatus` (DB entity), `ExotelCallStatus`.
            - **Core Logic**: `Domain.Action.UI.Call` handles interactions with the telephony provider, number masking, and `CallStatus` DB updates.
        - **Driver Call Management (`API.UI.Call.hs`)**: // ... (existing detailed content) ...
        - **Driver Call Event Logging (`API.UI.CallEvent.hs`)** (Source file):
            - **Purpose**: Enables granular logging of specific events occurring during or related to platform-mediated calls for drivers.
            - **Endpoint**: `POST /v2/ui/callEvent`.
            - **Authentication**: Requires `TokenAuth` (driver session). Note: While `TokenAuth` provides `(PersonId, MerchantId, MerchantOperatingCityId)` context, the handler `logCallEvent (_, _, _)` pattern indicates these specific IDs are not directly passed to the domain action, implying context is within `CallEventReq` or inferred by the domain logic.
            - **Request Body**: `DCE.CallEventReq` (from `Domain.Action.UI.CallEvent`), containing call identifier, event type (e.g., "CALL_ANSWERED", "DTMF_INPUT"), timestamp, and associated event data.
            - **Response Type**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `logCallEvent` delegates to `Domain.Action.UI.CallEvent.logCallEvent`.
            - **Logic**: The domain action validates and stores the call event data in DB, linking it to the relevant call session for detailed analytics, troubleshooting, and audit purposes.
        - `API.UI.SavedReqLocation` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/SavedReqLocation.hs`):
            - **Purpose**: Manages a rider's saved locations (e.g., "Home", "Work").
            - **Endpoints**:
                - `POST /savedLocation`: Creates/saves a new location. Requires `CreateSavedReqLocationReq` in body.
                - `GET /savedLocation/list`: Lists all saved locations for the user. Returns `SavedReqLocationsListRes`.
                - `DELETE /savedLocation/{tag}`: Deletes a saved location identified by its `tag`.
            - **Authentication**: All endpoints use `TokenAuth`.
            - **Delegation**: Business logic is handled by functions in `Domain.Action.UI.SavedReqLocation`.
            - **Storage Interaction (via Domain Layer)**: The domain logic in `Domain.Action.UI.SavedReqLocation` relies on `Storage.Queries.SavedReqLocation` (specifically functions from `Storage.Queries.SavedReqLocationExtra.hs`) for database operations:
                - `QSavedReqLocation.create`: To persist new saved locations.
                - `QSavedReqLocation.findAllByRiderId`: To list all locations for a user (ordered by `updatedAt` desc).
                - `QSavedReqLocation.findAllByRiderIdAndTag`: To check for tag uniqueness before creation.
                - `QSavedReqLocation.deleteByRiderIdAndTag`: To delete a specific saved location.
                - Other queries like `findByLatLonAndRiderId` and `countAllByRiderId` are also available for more specific lookups.
        - `API.UI.RentalsIntercityCache` (located in `Backend/app/rider-platform/rider-app/Main/src/API/UI/RentalsIntercityCache.hs`):
            - **Endpoint & Purpose**: `POST /v2/fetchFareCache` for retrieving cached fare information for rental/intercity services.
            - **Request/Response**: Uses `RIC.FareCacheReq` and `RIC.FareCacheResp` (types defined in `Domain.Types.RentalsIntercityCache`).
            - **Authentication**: Requires `TokenAuth`.
            - **Delegation**: Handler `rentalsIntercityCache` delegates to `Domain.Action.UI.RentalsIntercityCache.rentalsIntercityCache`.
            - **Caching Mechanism**: The domain action interacts with a cache (details of implementation - Redis, DB table - would be within the domain/storage layer) to store and retrieve these fares.
        - `API.Action.UI.MultimodalConfirm` (Namma DSL generated from `src-read-only/API/Action/UI/MultimodalConfirm.hs`, mounted in `API.UI.hs` context likely under `/multimodal/`):
            - **Purpose**: Manages the full lifecycle of a selected multimodal journey.
            - **Endpoints**: Provides numerous authenticated endpoints for: initiating (`/{journeyId}/initiate`), confirming (`/{journeyId}/confirm`), getting info/status (various `/booking/info`, `/booking/paymentStatus`, `/journey/status`), managing payments (`/{journeyId}/payment/updateOrder`), modifying journey legs (switch, skip, add, extend, getLegTierOptions, switchTaxi, switchFRFSTier, setStatus - under `/{journeyId}/leg/` or `/{journeyId}/order/{legOrder}/`), cancelling (`/journey/{journeyId}/cancel`), updating rider location (`/{journeyId}/rider/location`), managing journey feedback, and user multimodal preferences (`/user/preferences`). Also includes `/transitOptions/lite` and `/publicTransport/data`.
            - **Request/Response Types**: Uses various types from `API.Types.UI.MultimodalConfirm` (e.g., `JourneyInfoResp`, `JourneyConfirmReq`, `UpdatePaymentOrderReq`, `SwitchLegReq`, `ExtendLegReq`, `JourneyFeedBackForm`, `MultimodalUserPreferences`).
            - **Delegation**: All handlers delegate to corresponding functions in `Domain.Action.UI.MultimodalConfirm`.
            - **Core Logic**: The domain module orchestrates state for `Domain.Types.Journey.Journey` and `Lib.JourneyLeg.Types.JourneyLegStatus`, interacts with BPPs for individual legs (likely via Beckn), and manages payments/preferences.
        - `API.Action.UI.BBPS` (Namma DSL generated, mounted in `API.UI.hs` context, likely under `/bbps/`):
            - **Purpose**: Manages specialized interactions with CRIS for metro/subway services.
            - **Endpoints & Purpose**:
                - `POST /v2/cris/getSDKData`: Fetches data for CRIS SDK. Takes `API.Types.UI.CRIS.GetSDKDataRequest`, returns `API.Types.UI.CRIS.GetSDKDataResponse`.
                - `GET /v2/cris/otp/generation`: Requests CRIS OTP generation.
                - `POST /v2/cris/change/device`: Manages device registration with CRIS. Takes `API.Types.UI.CRIS.CrisChangeDeviceRequest`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.CRIS` (e.g., `postCrisGetSDKData`, `getCrisOtpGeneration`, `postCrisChangeDevice`).
            - **CRIS Communication**: The domain actions handle direct HTTP client communication with external CRIS APIs.
        - `API.Action.UI.CRIS` (Namma DSL generated from `src-read-only/API/Action/UI/CRIS.hs`, mounted in `API.UI.hs` context, likely under `/cris/`):
            - **Purpose**: Manages specialized interactions with CRIS for metro/subway services.
            - **Endpoints & Purpose**:
                - `POST /v2/cris/getSDKData`: Fetches data for CRIS SDK. Takes `API.Types.UI.CRIS.GetSDKDataRequest`, returns `API.Types.UI.CRIS.GetSDKDataResponse`.
                - `GET /v2/cris/otp/generation`: Requests CRIS OTP generation.
                - `POST /v2/cris/change/device`: Manages device registration with CRIS. Takes `API.Types.UI.CRIS.CrisChangeDeviceRequest`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.CRIS` (e.g., `postCrisGetSDKData`, `getCrisOtpGeneration`, `postCrisChangeDevice`).
            - **CRIS Communication**: The domain actions handle direct HTTP client communication with external CRIS APIs.
        - `API.Action.UI.TicketService` (Namma DSL generated from `src-read-only/API/Action/UI/TicketService.hs`, mounted in `API.UI.hs` context, likely under `/ticket/`):
            - **Purpose**: Manages the lifecycle for public transport ticketing.
            - **Endpoints & Purpose**:
                - `GET /v2/ticket/places`: Lists ticketable places.
                - `GET /v2/ticket/places/{placeId}/services`: Lists services at a place (query by `date`).
                - `POST /v2/ticket/places/{placeId}/book`: Books a ticket (takes `API.Types.UI.TicketService.TicketBookingReq`), returns `Kernel.External.Payment.Interface.Types.CreateOrderResp` for payment processing.
                - `GET /v2/ticket/bookings`: Lists user's ticket bookings (filters: `limit`, `offset`, `status`).
                - `GET /v2/ticket/bookings/{ticketBookingShortId}/details`: Gets details of a specific booking.
                - `POST /v2/ticket/bookings/{personServiceId}/{ticketServiceShortId}/verify`: Verifies a ticket.
                - `GET /v2/ticket/bookings/{ticketBookingShortId}/status`: Gets booking status.
                - `POST /v2/ticket/booking/cancel`: Cancels a ticket booking (`API.Types.UI.TicketService.TicketBookingCancelReq`).
                - `POST /v2/ticket/bookings/update/seats`: Updates seats for a booking (`API.Types.UI.TicketService.TicketBookingUpdateSeatsReq`).
                - `POST /v2/ticket/service/cancel`: Cancels a ticket service (`API.Types.UI.TicketService.TicketServiceCancelReq`).
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.TicketService`.
            - **Key Data Types**: `Domain.Types.TicketPlace.TicketPlace`, `API.Types.UI.TicketService.TicketServiceResp`, `API.Types.UI.TicketService.TicketBookingReq`, `API.Types.UI.TicketService.TicketBookingAPIEntity`, `Domain.Types.TicketBooking.BookingStatus`.
            - **Payment Integration**: Ticket booking uses the platform's standard payment order creation mechanism.
        - `API.Action.UI.FRFSTicketService` (Namma DSL generated from `src-read-only/API/Action/UI/FRFSTicketService.hs`, mounted in `API.UI.hs` context, likely under `/frfs/`):
            - **Purpose**: Manages full lifecycle for FRFS-based public transport ticketing (e.g., buses).
            - **Endpoints & Purpose (all `/v2/frfs/...` and TokenAuth)**:
                - Route/Station Discovery: `GET /routes`, `GET /stations` (with various filters like city, vehicleType, location), `GET /route/{routeCode}`, `GET /autocomplete`.
                - Search & Quoting: `POST /search` (takes `FRFSSearchAPIReq`, returns `FRFSSearchAPIRes`), `POST /discovery/search` (takes `FRFSDiscoverySearchAPIReq`), `GET /search/{searchId}/quote` (returns `[FRFSQuoteAPIRes]`).
                - Booking: `POST /quote/{quoteId}/confirm` (and a `/v2` version with `FRFSQuoteConfirmReq`), returns `FRFSTicketBookingStatusAPIRes`. This step involves payment order creation.
                - Payment Retry: `POST /quote/{quoteId}/payment/retry`.
                - Booking Management: `GET /booking/{bookingId}/status`, `GET /booking/list`, `POST /booking/{bookingId}/canCancel`, `GET /booking/{bookingId}/canCancel/status`, `POST /booking/{bookingId}/cancel`, `GET /booking/cancel/{bookingId}/status`.
                - Ticket Verification: `POST /ticket/verify` (takes `FRFSTicketVerifyReq`).
                - Configuration: `GET /config` (for a city, returns `FRFSConfigAPIRes`).
            - **Delegation**: All handlers delegate to `Domain.Action.UI.FRFSTicketService`.
            - **Key Data Types**: Uses types from `API.Types.UI.FRFSTicketService`, `Domain.Types.FRFSQuote`, `Domain.Types.FRFSSearch`, `Domain.Types.FRFSTicketBooking`, `BecknV2.FRFS.Enums.VehicleCategory`.
            - **Payment Integration**: Booking confirmation returns `Kernel.External.Payment.Interface.Types.CreateOrderResp`, indicating use of the standard platform payment flow.
            - **FRFS Data Sources**: Domain layer interacts with external FRFS data (GTFS, operator APIs, Beckn BPPs for FRFS).
        - `API.Action.UI.TicketKapture` (Namma DSL generated from `src-read-only/API/Action/UI/TicketKapture.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Facilitates integration with Kapture CRM/Support system.
            - **Endpoint**: `POST /v2/kaptureCustomerLogin`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes no explicit request body in API definition, but handler receives auth info. Returns `API.Types.UI.TicketKapture.TicketKaptureResp` (likely containing Kapture session details or user context).
            - **Delegation**: Handler `postKaptureCustomerLogin` delegates to `Domain.Action.UI.TicketKapture.postKaptureCustomerLogin`.
            - **Kapture Communication**: The domain action handles direct HTTP client communication with external Kapture APIs.
        - `API.Action.UI.Insurance` (Namma DSL generated from `src-read-only/API/Action/UI/Insurance.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Retrieves details of an insurance policy.
            - **Endpoint**: `GET /v2/insurance/{referenceId}`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `referenceId` (Id `Domain.Types.Insurance.Insurance`). Returns `API.Types.UI.Insurance.InsuranceAPIEntity`.
            - **Delegation**: Handler `getInsurance` delegates to `Domain.Action.UI.Insurance.getInsurance`.
            - **Logic**: Domain action fetches policy details from DB, performs authorization checks.
        - `API.Action.UI.CustomerReferral` (Namma DSL generated from `src-read-only/API/Action/UI/CustomerReferral.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Manages the customer referral program.
            - **Endpoints & Purpose**:
                - `GET /v2/CustomerRefferal/count`: Get count of referred customers.
                - `POST /v2/person/applyReferral`: Apply a referral code (`API.Types.UI.CustomerReferral.ApplyCodeReq`). Returns `API.Types.UI.CustomerReferral.ReferrerInfo`.
                - `GET /v2/referral/verifyVpa?vpa={vpaText}`: Verify a VPA for payouts. Returns `API.Types.UI.CustomerReferral.VpaResp`.
                - `GET /v2/referralPayout/history`: View referral payout history. Returns `API.Types.UI.CustomerReferral.PayoutHistory`.
                - `POST /v2/payoutVpa/upsert`: Add/update VPA for payouts (`API.Types.UI.CustomerReferral.UpdatePayoutVpaReq`).
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.CustomerReferral`.
            - **Key Data Types**: Uses types from `API.Types.UI.CustomerReferral`.
            - **Payment Integration (Implied)**: VPA verification and payout processing likely involves the `payment` shared library or direct integration with a UPI payment gateway.
        - `API.Action.UI.SocialLogin` (Namma DSL generated from `src-read-only/API/Action/UI/SocialLogin.hs`, mounted in `API.UI.hs` context, likely under `/social/`):
            - **Purpose**: Enables user login/signup via third-party social media providers and linking social profiles.
            - **Endpoints & Purpose**:
                - `POST /v2/social/login`: For social sign-in or sign-up. Unauthenticated. Takes `API.Types.UI.SocialLogin.SocialLoginReq` (provider name, social token/code). Returns `API.Types.UI.SocialLogin.SocialLoginRes` (NammaYatri session token, user profile).
                - `POST /v2/social/update/profile`: For linking/updating social profile for an authenticated NammaYatri user. Requires `TokenAuth`. Takes `API.Types.UI.SocialLogin.SocialUpdateProfileReq`.
            - **Delegation**: Handlers delegate to `Domain.Action.UI.SocialLogin.postSocialLogin` and `Domain.Action.UI.SocialLogin.postSocialUpdateProfile`.
            - **Social Provider Communication**: Domain actions perform server-to-server validation of social tokens with the respective providers (e.g., Google, Facebook via their APIs) and fetch user details.
            - **Account Logic**: Handles NammaYatri user account lookup, creation (if new social user), and linking of social ID to NammaYatri profile.
        - `API.Action.UI.FavouriteDriver` (Namma DSL generated from `src-read-only/API/Action/UI/FavouriteDriver.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Manages a rider's list of favorite drivers.
            - **Endpoints & Purpose**:
                - `GET /v2/driver/favorites`: Lists the authenticated rider's favorite drivers. Returns `[API.Types.UI.FavouriteDriver.FavouriteDriverResp]`.
                - `POST /v2/favorites/{driverId}/remove`: Removes a driver (by `driverId` Text) from the user's favorites.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to `Domain.Action.UI.FavouriteDriver.getDriverFavorites` and `Domain.Action.UI.FavouriteDriver.postFavoritesRemove` respectively.
            - **Logic**: Domain actions handle database queries to retrieve or delete favorite driver associations for the user.
        - `API.Action.UI.EstimateBP` (Namma DSL generated from `src-read-only/API/Action/UI/EstimateBP.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Retrieves a detailed fare estimate breakup for a specific ride.
            - **Endpoint**: `GET /v2/ride/{rideId}/estimateBreakup`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `rideId` (Id `Domain.Types.Ride.Ride`) as path parameter. Returns `API.Types.UI.EstimateBP.EstimateDetailsRes` (containing detailed fare components).
            - **Delegation**: Handler `getRideEstimateBreakup` delegates to `Domain.Action.UI.EstimateBP.getRideEstimateBreakup`.
            - **Logic**: Domain action fetches ride details and calculates/retrieves its fare component breakdown (base, distance, time, taxes, tolls, surge, discounts).
        - `API.Action.UI.NearbyDrivers` (Namma DSL generated from `src-read-only/API/Action/UI/NearbyDrivers.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Fetches information about nearby available drivers.
            - **Endpoint**: `POST /v2/nearbyDrivers`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `API.Types.UI.NearbyDrivers.NearbyDriverReq` (containing rider location, radius, filters). Returns `API.Types.UI.NearbyDrivers.NearbyDriverRes` (list of nearby drivers with location, vehicle type, etc.).
            - **Delegation**: Handler `postNearbyDrivers` delegates to `Domain.Action.UI.NearbyDrivers.postNearbyDrivers`.
            - **Logic**: Domain action performs geospatial queries against a real-time driver location store (potentially Redis geo commands or a geospatial DB) and filters by availability/criteria.
        - `API.Action.UI.NearbyBuses` (Namma DSL generated from `src-read-only/API/Action/UI/NearbyBuses.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Provides real-time information about nearby public transport (buses) and upcoming vehicle details.
            - **Endpoints & Purpose**:
                - `POST /v2/nearbyBusBooking`: Fetches nearby buses based on `API.Types.UI.NearbyBuses.NearbyBusesRequest` (containing user location, criteria). Returns `API.Types.UI.NearbyBuses.NearbyBusesResponse`.
                - `GET /v2/nextVehicleDetails/{routeCode}/{stopCode}`: Gets upcoming vehicle details for a specific route/stop. Query param `vehicleType` (`BecknV2.FRFS.Enums.VehicleCategory`). Returns `Lib.JourneyModule.Utils.UpcomingTripInfo`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to `Domain.Action.UI.NearbyBuses.postNearbyBusBooking` and `Domain.Action.UI.NearbyBuses.getNextVehicleDetails`.
            - **Data Sources**: Domain actions query real-time public transport data feeds (e.g., GTFS-RT, transit agency APIs).
            - **Integration**: `UpcomingTripInfo` suggests integration with multimodal journey planning via `Lib.JourneyModule.Utils`.
        - `API.Action.UI.Places` (Namma DSL generated from `src-read-only/API/Action/UI/Places.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Fetches information about specific places or Points of Interest (POIs).
            - **Endpoint**: `POST /v2/places`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `API.Types.UI.Places.PlacesRequest` (containing location context, query, filters). Returns `API.Types.UI.Places.PlacesResponse` (list of places with details).
            - **Delegation**: Handler `postPlaces` delegates to `Domain.Action.UI.Places.postPlaces`.
            - **Logic**: Domain action queries an external POI database or place search API (e.g., Google Places, Foursquare, possibly via `external` library).
        - `API.Action.UI.TrackRoute` (Namma DSL generated from `src-read-only/API/Action/UI/TrackRoute.hs`, mounted in `API.UI.hs` context, likely under `/track/`):
            - **Purpose**: Provides live tracking of public transport vehicles (e.g., buses) on a specific route.
            - **Endpoint**: `GET /v2/track/{routeCode}/vehicles`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `routeCode` (Text) as path parameter, and optional query params `platformType` (`Domain.Types.IntegratedBPPConfig.PlatformType`) and `vehicleType` (`BecknV2.FRFS.Enums.VehicleCategory`). Returns `API.Types.UI.TrackRoute.TrackingResp` (list of vehicle locations/details on the route).
            - **Delegation**: Handler `getTrackVehicles` delegates to `Domain.Action.UI.TrackRoute.getTrackVehicles`.
            - **Data Sources**: Domain action queries real-time public transport data feeds (e.g., GTFS-RT, transit agency APIs) for the specified route.
        - `API.UI.Route` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Route.hs`):
            - **Purpose**: Fetches static route geometry and details (polyline, distance, time) from an external mapping service.
            - **Endpoints & Purpose**:
                - `POST /route`: General route request. Takes `Maps.GetRoutesReq` (origin, destination, waypoints, mode).
                - `POST /pickup/route`: Route from driver to rider pickup. Takes `DRoute.GetPickupRoutesReq` (ride/booking identifiers).
                - `POST /trip/route`: Route for an ongoing or completed trip. Takes `Maps.GetRoutesReq`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Response (Common)**: `Maps.GetRoutesResp` (polyline, distance, time, maneuvers).
            - **Delegation**: Handlers (`getRoute`, `getPickupRoute`, `getTripRoute`) delegate to `Domain.Action.UI.Route` (e.g., `DRoute.getRoutes`, `DRoute.getPickupRoutes`, `DRoute.getTripRoutes`).
            - **External Mapping Service**: Domain actions use `Kernel.External.Maps.Interface` to call an external service (e.g., OSRM, Google Maps).
        - `API.UI.Serviceability` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Serviceability.hs`):
            - **Purpose**: Checks serviceability of locations and identifies intercity trips.
            - **Endpoints & Purpose**:
                - `POST /serviceability/origin`: Checks if origin `LatLong` (in `ServiceabilityReq`) is serviceable. Returns `DServiceability.ServiceabilityRes`.
                - `POST /serviceability/destination`: Checks if destination `LatLong` (in `ServiceabilityReq`) is serviceable. Returns `DServiceability.ServiceabilityRes`.
                - `POST /serviceability/isInterCity`: Checks if trip is intercity. Takes `BPPInternal.IsIntercityReq`. Returns `BPPInternal.IsIntercityResp`.
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation & Logic**:
                - Origin/Destination: `Domain.Action.UI.Serviceability.checkServiceability` (uses `GeofencingConfig` and `GeoRestriction`).
                - Intercity Check: `SharedLogic.CallBPPInternal.getIsInterCity` (uses merchant configs from `CQM.findById` and BPP/platform-specific logic).
        - `API.UI.HotSpot` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/HotSpot.hs`):
            - **Purpose**: Identifies and returns relevant "hotspots" (popular or designated locations) near a user-provided location.
            - **Endpoint**: `GET /v2/getHotSpot` (takes `Maps.LatLong` in request body).
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `Maps.LatLong`. Returns `HotSpot.HotSpotResponse` (list of `HotSpotInfo` and `blockRadius`).
            - **Logic**: Handler `getHotspot` fetches `HotSpotConfig` (from `QHotSpotConfig`), uses geohashing (`Data.Geohash`) and custom geospatial math to find nearby geohashes. Retrieves pre-aggregated `HotSpot` frequency data (counts for various user activities like pickups, saved locations, trip starts/ends, special designations) from Redis (`Hedis.get` with `makeHotSpotKey`). Filters by frequency, groups by precision, ranks by weighted activity frequencies (weights from `HotSpotConfig`), and limits results.
            - **Key Data Types**: `Maps.LatLong`, `HotSpot.HotSpotResponse`, `HotSpot.HotSpotInfo`, `Domain.Types.HotSpot.HotSpot`, `Domain.Types.HotSpotConfig.HotSpotConfig`.
            - **Dependencies**: `Data.Geohash`, `Storage.CachedQueries.HotSpotConfig`, `Kernel.Storage.Hedis`.
        - `API.UI.Maps` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Maps.hs`):
             - **Purpose**: Provides proxy access to external mapping services for autocomplete, place details, and reverse geocoding.
             - **Endpoints & Purpose (all under `/v2/maps/` and require `TokenAuth`)**:
                 - `POST /autoComplete`: Address/place autocomplete. Takes `DMaps.AutoCompleteReq` (input text, optional location). Returns `DMaps.AutoCompleteResp` (list of suggestions).
                 - `POST /getPlaceDetails`: Fetches details for a place ID. Takes `DMaps.GetPlaceDetailsReq` (`placeId`). Returns `DMaps.GetPlaceDetailsResp` (formatted address, coordinates, etc.).
                 - `POST /getPlaceName`: Reverse geocoding. Takes `DMaps.GetPlaceNameReq` (latitude, longitude). Returns `DMaps.GetPlaceNameResp` (formatted address(es)).
             - **Delegation**: Handlers (`autoComplete`, `getPlaceDetails`, `getPlaceName`) call respective functions in `Domain.Action.UI.Maps` (e.g., `DMaps.autoComplete`, `DMaps.getPlaceDetails`, `DMaps.getPlaceName`), which then interact with an external mapping service via `Kernel.External.Maps.Interface`.
             - **Logging**: Wraps domain calls with `withPersonIdLogTag` for contextual logging.
        - `API.UI.Frontend` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Frontend.hs`):
            - **Purpose**: Manages user flow status within the application and handles event notifications from the frontend.
            - **Endpoints & Purpose (all under `/v2/frontend/` and require `TokenAuth`)**:
                - `GET /flowStatus`: Queries the user's current application flow status. Optional query params `isPolling` (Bool) and `checkForActiveBooking` (Bool). Returns `DFrontend.GetPersonFlowStatusRes`.
                - `POST /notifyEvent`: Allows frontend to send notifications about UI events. Takes `DFrontend.NotifyEventReq` (containing `DFrontend.FrontendEvent` and optional data). Returns `DFrontend.NotifyEventResp`.
            - **Delegation**: Handlers delegate to `Domain.Action.UI.Frontend.getPersonFlowStatus` and `Domain.Action.UI.Frontend.notifyEvent`.
            - **Logic**: Domain actions assess/update user state or log events based on the request.
        - `API.Action.UI.EditLocation` (Namma DSL generated from `src-read-only/API/Action/UI/EditLocation.hs`, mounted in `API.UI.hs` context, likely under `/edit/`):
            - **Purpose**: Manages the rider confirmation part of an asynchronous location edit process for an active ride.
            - **Endpoints & Purpose (all `/v2/edit/...` and require `TokenAuth`)**:
                - `GET /{bookingUpdateRequestId}/result`: Polls/retrieves the outcome of a pending location edit request (e.g., new fare, BPP approval status). Returns `API.Types.UI.EditLocation.EditLocationResultAPIResp`.
                - `POST /result/{bookingUpdateRequestId}/confirm`: Rider confirms acceptance of the proposed edit. Returns `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handlers delegate to `Domain.Action.UI.EditLocation.getEditResult` and `Domain.Action.UI.EditLocation.postEditResultConfirm`.
            - **Core Logic**: Domain actions interact with `Domain.Types.BookingUpdateRequest.BookingUpdateRequest` entities (which are populated/updated by BPP `on_update` callbacks in response to an initial edit request probably made via `API.UI.Ride`). The confirmation step finalizes the update.
        - `API.Action.UI.FollowRide` (Namma DSL generated from `src-read-only/API/Action/UI/FollowRide.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Manages ride sharing and tracking for safety/convenience.
            - **Endpoints & Purpose (all `/v2/...` and require `TokenAuth`)**:
                - `GET /follow/ride`: Lists who is following the user's ride(s). Returns `[API.Types.UI.FollowRide.Followers]`.
                - `POST /share/ride`: Initiates ride sharing. Takes `API.Types.UI.FollowRide.ShareRideReq`.
                - `GET /followRide/ECStatus/{rideId}`: For followers to check emergency contact status for a specific ride. Returns `API.Types.UI.FollowRide.EmergencyContactsStatusRes`.
                - `GET /followRide/{rideId}/customerDetails`: For followers to get basic rider details. Returns `API.Types.UI.FollowRide.FollowRideCustomerDetailsRes`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.FollowRide`.
            - **Logic**: Domain actions manage sharing permissions, record follower data, and retrieve relevant ride/rider information for authorized followers.
        - `API.UI.AadhaarVerification` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/AadhaarVerification.hs`):
            - **Purpose**: Supports Aadhaar-based eKYC for identity verification.
            - **Endpoints & Purpose (all `/v2/verifyAadhaar/...` and require `TokenAuth`)**:
                - `POST /generateOtp`: Initiates Aadhaar OTP generation. Takes `Tools.AadhaarVerification.AadhaarOtpReq` (Aadhaar number). Returns `Tools.AadhaarVerification.AadhaarVerificationResp` (e.g., transaction ID).
                - `POST /verifyOtp`: Verifies the received OTP. Takes `Domain.Action.UI.AadhaarVerification.VerifyAadhaarOtpReq` (OTP, transaction ID). Returns `Tools.AadhaarVerification.AadhaarOtpVerifyRes` (verification status, potentially KYC data).
            - **Delegation**: Handlers delegate to `Domain.Action.UI.AadhaarVerification.generateAadhaarOtp` and `Domain.Action.UI.AadhaarVerification.verifyAadhaarOtp`.
            - **External Service**: Domain actions interact with an external Aadhaar verification service, likely via client logic in `Tools.AadhaarVerification`.
        - `API.UI.AppInstalls` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/AppInstalls.hs`):
            - **Purpose**: Tracks app installation details.
            - **Endpoint**: `POST /v2/appInstalls/create`.
            - **Authentication**: Unauthenticated.
            - **Request/Response**: Takes `DAppInstalls.AppInstallsReq` (app version, device ID, OS, platform). Returns `APISuccess.APISuccess`.
            - **Delegation**: Handler `createAppInstallsDetails` delegates to `Domain.Action.UI.AppInstalls.createAppInstallsDetails`.
            - **Logic**: Domain action validates and stores app/device information for analytics and tracking.
        - `API.UI.CancellationReason` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/CancellationReason.hs`):
            - **Purpose**: Provides a list of standardized cancellation reasons.
            - **Endpoint**: `GET /v2/cancellationReason/list`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes mandatory query param `cancellationStage` (`DCR.CancellationStage`). Returns `[DCancellationReason.CancellationReasonAPIEntity]`.
            - **Delegation**: Handler `list` delegates to `Domain.Action.UI.CancellationReason.list`.
            - **Logic**: Domain action fetches context-specific cancellation reasons from a configured source (DB/config).
        - `API.UI.GoogleTranslate` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/GoogleTranslate.hs`):
            - **Purpose**: Acts as a backend proxy for Google Translate API.
            - **Endpoint**: `GET /v2/language/translate`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes query params `source` (`Maps.Language`), `target` (`Maps.Language`), and `q` (Text to translate). Returns `GoogleTranslate.TranslateResp` (containing translated text).
            - **Delegation**: Handler `translate` delegates to `SharedLogic.GoogleTranslate.translate`.
            - **External Service**: `SharedLogic.GoogleTranslate.translate` constructs and sends the request to the external Google Translate API, handling the API key and response.
        - `API.UI.Disability` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Disability.hs`):
            - **Purpose**: Lists supported disability types or accessibility options.
            - **Endpoint**: `GET /v2/disability/list`.
            - **Authentication**: Requires `TokenAuth`.
            - **Response**: `[Domain.Types.Disability.Disability]`.
            - **Delegation**: Handler `listDisabilities` delegates to `Domain.Action.UI.Disability.listDisabilities`.
            - **Logic**: Domain action fetches predefined disability types from configuration or DB.
        - `API.UI.PartnerOrganizationFRFS` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/PartnerOrganizationFRFS.hs`):
            - **Purpose**: Provides B2B FRFS ticketing integration for partner organizations.
            - **Partner Endpoints (API Key Auth, under `/frfs/partnerOrganization/{apiKey}/`)**: `POST /upsertPersonAndGetFare`, `GET /getConfig/...`, `POST /getFareV2`, `POST /upsertPersonAndQuoteConfirm`.
            - **User/Ticket Endpoints (under `/frfs/`)**: `GET /shareTicketInfo/{ticketBookingId}`, `POST /auth/{ticketBookingId}`, `POST /authVerify`.
            - **Request/Response Types**: Uses types from `API.Types.UI.FRFSTicketService` and `Domain.Types.PartnerOrganizationFRFS` (e.g., `DPOFRFS.GetFareReq`, `DPOFRFS.GetFareResp`, `DPOFRFS.UpsertPersonAndQuoteConfirmReq`).
            - **Delegation**: Handlers delegate to functions in `Domain.Action.UI.PartnerOrganizationFRFS`.
            - **Logic**: Manages partner API key validation, rate limiting (`PartnerOrgConfig`, Redis), end-user upsertion (`DPOFRFS.upsertPersonAndGetToken`), and reuses core FRFS logic from `Domain.Action.UI.FRFSTicketService`.
        - `API.UI.PersonStats` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/PersonStats.hs`):
            - **Purpose**: Retrieves personal usage statistics for the authenticated user.
            - **Endpoint**: `GET /v2/personStats`.
            - **Authentication**: Requires `TokenAuth`.
            - **Response**: `DPersonStats.PersonStatsRes` (containing aggregated metrics like total rides, distance, spending).
            - **Delegation**: Handler `getPersonStats` delegates to `Domain.Action.UI.PersonStats.getPersonStats`.
            - **Logic**: Domain action queries and aggregates data from various database tables (rides, bookings, payments) to compute user-specific statistics.
        - `API.UI.Whatsapp` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/UI/Whatsapp.hs`):
            - **Purpose**: Manages user opt-in/opt-out preferences for WhatsApp communications.
            - **Endpoint**: `POST /v2/whatsapp/opt`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `Whatsapp.OptAPIRequest` (likely with an opt-in/out boolean). Returns `APISuccess.APISuccess`.
            - **Delegation**: Handler `whatsAppOptAPI` delegates to `Domain.Action.UI.Whatsapp.whatsAppOptAPI`.
            - **Logic**: Domain action updates user preferences in the database and may interact with a WhatsApp Business API provider to register/deregister the user.
        - `API.Action.UI.Cac` (Namma DSL generated from `src-read-only/API/Action/UI/Cac.hs`, mounted in `API.UI.hs` context):
            - **Purpose**: Manages the lifecycle for public transport ticketing.
            - **Endpoints & Purpose**:
                - `GET /v2/ticket/places`: Lists ticketable places.
                - `GET /v2/ticket/places/{placeId}/services`: Lists services at a place (query by `date`).
                - `POST /v2/ticket/places/{placeId}/book`: Books a ticket (takes `API.Types.UI.TicketService.TicketBookingReq`), returns `Kernel.External.Payment.Interface.Types.CreateOrderResp` for payment processing.
                - `GET /v2/ticket/bookings`: Lists user's ticket bookings (filters: `limit`, `offset`, `status`).
                - `GET /v2/ticket/bookings/{ticketBookingShortId}/details`: Gets details of a specific booking.
                - `POST /v2/ticket/bookings/{personServiceId}/{ticketServiceShortId}/verify`: Verifies a ticket.
                - `GET /v2/ticket/bookings/{ticketBookingShortId}/status`: Gets booking status.
                - `POST /v2/ticket/booking/cancel`: Cancels a ticket booking (`API.Types.UI.TicketService.TicketBookingCancelReq`).
                - `POST /v2/ticket/bookings/update/seats`: Updates seats for a booking (`API.Types.UI.TicketService.TicketBookingUpdateSeatsReq`).
                - `POST /v2/ticket/service/cancel`: Cancels a ticket service (`API.Types.UI.TicketService.TicketServiceCancelReq`).
            - **Authentication**: All endpoints require `TokenAuth`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.TicketService`.
            - **Key Data Types**: `Domain.Types.TicketPlace.TicketPlace`, `API.Types.UI.TicketService.TicketServiceResp`, `API.Types.UI.TicketService.TicketBookingReq`, `API.Types.UI.TicketService.TicketBookingAPIEntity`, `Domain.Types.TicketBooking.BookingStatus`.
            - **Payment Integration**: Ticket booking uses the platform's standard payment order creation mechanism.
        - `API.Action.UI.DeletedPerson` (Namma DSL generated from `src-read-only/API/Action/UI/DeletedPerson.hs`, mounted in `API.UI.hs` context, likely under `/deleted/person/`):
            - **Purpose**: Handles requests for user account deletion.
            - **Endpoint**: `POST /v2/deleted/person`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `API.Types.UI.DeletedPerson.DeletedPersonReq` (content may include confirmation/reason). Returns `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `postDeletedPerson` delegates to `Domain.Action.UI.DeletedPerson.postDeletedPerson`.
            - **Logic**: Domain action initiates the account deletion process: marking account, anonymizing/deleting PII (respecting data retention policies via `Storage.Beam.DeletedPerson` or similar), invalidating sessions, and logging. May be immediate or scheduled.
        - `API.Action.UI.Miscellaneous` (Namma DSL generated from `src-read-only/API/Action/UI/Miscellaneous.hs`, mounted in `API.UI.hs` context, likely under `/misc/`):
            - **Purpose**: Currently provides a QR Scan Test Utility.
            - **Endpoint**: `POST /v2/misc/testScanQR`.
            - **Authentication**: Requires `TokenAuth`.
            - **Request/Response**: Takes `API.Types.UI.Miscellaneous.QRScanTestReq`. Returns `API.Types.UI.Miscellaneous.QRScanTestResp`.
            - **Delegation**: Handler `postMiscTestScanQR` delegates to `Domain.Action.UI.Miscellaneous.postMiscTestScanQR`.
            - **Logic**: Domain action parses QR data and performs test logic.
            - **Internal APIs (`API.Internal.hs` - mounted under `/internal/`)**:
                - `API.Internal.Rating` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/Rating.hs`):
                    - **Purpose**: Internal submission of ride feedback/ratings.
                    - **Endpoint**: `POST /internal/feedback/rateRide`.
                    - **Authentication**: Optional header `token` (Text).
                    - **Request/Response**: Takes `Domain.FeedbackReq`. Returns `Kernel.Types.APISuccess.APISuccess`.
                    - **Delegation**: Handler `rating` delegates to `Domain.Action.Internal.Rating.rating`.
                    - **Logic**: Domain action processes and stores the feedback, potentially interacting with BPPs.
                - `API.Internal.FRFS` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/FRFS.hs`):
                    - **Purpose**: Internal updates to FRFS entity statuses.
                    - **Endpoint**: `POST /internal/frfs/statusUpdate`.
                    - **Authentication**: None explicit at this level.
                    - **Request/Response**: Takes `Domain.FRFSStatusUpdateReq`. Returns `Kernel.Types.APISuccess.APISuccess`.
                    - **Delegation**: Handler `frfsStatusUpdate` delegates to `Domain.Action.Internal.FRFS.frfsStatusUpdate`.
                    - **Logic**: Domain action validates and applies status updates to FRFS entities (bookings, services).
                - `API.Internal.Cac` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/Cac.hs`):
                    - **Purpose**: Manages the lifecycle for public transport ticketing.
                    - **Endpoints & Purpose**:
                        - `GET /v2/ticket/places`: Lists ticketable places.
                        - `GET /v2/ticket/places/{placeId}/services`: Lists services at a place (query by `date`).
                        - `POST /v2/ticket/places/{placeId}/book`: Books a ticket (takes `API.Types.UI.TicketService.TicketBookingReq`), returns `Kernel.External.Payment.Interface.Types.CreateOrderResp` for payment processing.
                        - `GET /v2/ticket/bookings`: Lists user's ticket bookings (filters: `limit`, `offset`, `status`).
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/details`: Gets details of a specific booking.
                        - `POST /v2/ticket/bookings/{personServiceId}/{ticketServiceShortId}/verify`: Verifies a ticket.
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/status`: Gets booking status.
                        - `POST /v2/ticket/booking/cancel`: Cancels a ticket booking (`API.Types.UI.TicketService.TicketBookingCancelReq`).
                        - `POST /v2/ticket/bookings/update/seats`: Updates seats for a booking (`API.Types.UI.TicketService.TicketBookingUpdateSeatsReq`).
                        - `POST /v2/ticket/service/cancel`: Cancels a ticket service (`API.Types.UI.TicketService.TicketServiceCancelReq`).
                    - **Authentication**: All endpoints require `TokenAuth`.
                    - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.TicketService`.
                    - **Key Data Types**: `Domain.Types.TicketPlace.TicketPlace`, `API.Types.UI.TicketService.TicketServiceResp`, `API.Types.UI.TicketService.TicketBookingReq`, `API.Types.UI.TicketService.TicketBookingAPIEntity`, `Domain.Types.TicketBooking.BookingStatus`.
                    - **Payment Integration**: Ticket booking uses the platform's standard payment order creation mechanism.
                - `API.Internal.StopEvents` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/StopEvents.hs`):
                    - **Purpose**: Manages the lifecycle for public transport ticketing.
                    - **Endpoints & Purpose**:
                        - `GET /v2/ticket/places`: Lists ticketable places.
                        - `GET /v2/ticket/places/{placeId}/services`: Lists services at a place (query by `date`).
                        - `POST /v2/ticket/places/{placeId}/book`: Books a ticket (takes `API.Types.UI.TicketService.TicketBookingReq`), returns `Kernel.External.Payment.Interface.Types.CreateOrderResp` for payment processing.
                        - `GET /v2/ticket/bookings`: Lists user's ticket bookings (filters: `limit`, `offset`, `status`).
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/details`: Gets details of a specific booking.
                        - `POST /v2/ticket/bookings/{personServiceId}/{ticketServiceShortId}/verify`: Verifies a ticket.
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/status`: Gets booking status.
                        - `POST /v2/ticket/booking/cancel`: Cancels a ticket booking (`API.Types.UI.TicketService.TicketBookingCancelReq`).
                        - `POST /v2/ticket/bookings/update/seats`: Updates seats for a booking (`API.Types.UI.TicketService.TicketBookingUpdateSeatsReq`).
                        - `POST /v2/ticket/service/cancel`: Cancels a ticket service (`API.Types.UI.TicketService.TicketServiceCancelReq`).
                    - **Authentication**: All endpoints require `TokenAuth`.
                    - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.TicketService`.
                    - **Key Data Types**: `Domain.Types.TicketPlace.TicketPlace`, `API.Types.UI.TicketService.TicketServiceResp`, `API.Types.UI.TicketService.TicketBookingReq`, `API.Types.UI.TicketService.TicketBookingAPIEntity`, `Domain.Types.TicketBooking.BookingStatus`.
                    - **Payment Integration**: Ticket booking uses the platform's standard payment order creation mechanism.
                - `API.Internal.FrequentLocUser` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/FrequentLocUser.hs`):
                    - **Purpose**: Manages the lifecycle for public transport ticketing.
                    - **Endpoints & Purpose**:
                        - `GET /v2/ticket/places`: Lists ticketable places.
                        - `GET /v2/ticket/places/{placeId}/services`: Lists services at a place (query by `date`).
                        - `POST /v2/ticket/places/{placeId}/book`: Books a ticket (takes `API.Types.UI.TicketService.TicketBookingReq`), returns `Kernel.External.Payment.Interface.Types.CreateOrderResp` for payment processing.
                        - `GET /v2/ticket/bookings`: Lists user's ticket bookings (filters: `limit`, `offset`, `status`).
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/details`: Gets details of a specific booking.
                        - `POST /v2/ticket/bookings/{personServiceId}/{ticketServiceShortId}/verify`: Verifies a ticket.
                        - `GET /v2/ticket/bookings/{ticketBookingShortId}/status`: Gets booking status.
                        - `POST /v2/ticket/booking/cancel`: Cancels a ticket booking (`API.Types.UI.TicketService.TicketBookingCancelReq`).
                        - `POST /v2/ticket/bookings/update/seats`: Updates seats for a booking (`API.Types.UI.TicketService.TicketBookingUpdateSeatsReq`).
                        - `POST /v2/ticket/service/cancel`: Cancels a ticket service (`API.Types.UI.TicketService.TicketServiceCancelReq`).
                    - **Authentication**: All endpoints require `TokenAuth`.
                    - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.TicketService`.
                    - **Key Data Types**: `Domain.Types.TicketPlace.TicketPlace`, `API.Types.UI.TicketService.TicketServiceResp`, `API.Types.UI.TicketService.TicketBookingReq`, `API.Types.UI.TicketService.TicketBookingAPIEntity`, `Domain.Types.TicketBooking.BookingStatus`.
                    - **Payment Integration**: Ticket booking uses the platform's standard payment order creation mechanism.
                - `API.Internal.DriverArrivalNotf` (Source file at `Backend/app/rider-platform/rider-app/Main/src/API/Internal/DriverArrivalNotf.hs`):
                    - **Purpose**: Internal triggering of driver arrival notifications to riders.
                    - **Endpoint**: `POST /internal/driverArrivalNotification`.
                    - **Authentication**: None explicit at this level (likely network-level or other internal mechanism).
                    - **Request/Response**: Takes `Domain.DANTypeValidationReq` (identifying ride/booking and event type). Returns `Kernel.Types.APISuccess.APISuccess`.
                    - **Delegation**: Handler `driverArrivalNotfHandler` delegates to `Domain.Action.Internal.DriverArrivalNotf.driverArrivalNotfHandler`.
                    - **Logic**: Domain action constructs and sends notifications (e.g., Push via `API.Action.UI.TriggerFCM`, SMS via `external` library) to the rider based on the input.
                - (Other internal API modules: `API.Action.UI.MeterRideInternal`, `API.Action.UI.InsuranceInternal` - names suggest they might be UI actions reused internally or specific internal versions).
            - **Database**: Beam for PostgreSQL.
            - **Authentication**: `passetto-client` for user sessions; custom tokens or network controls for some internal APIs.
            - **Beckn Integration**: Uses `beckn-spec` and `beckn-services`.
            - **Service Consumption**: Integrates with various shared libraries.
            - **Email**: `amazonka-ses`.
            - **GraphQL Client**: `morpheus-graphql-client`.
            - **Metrics**: `prometheus-client`, `wai-middleware-prometheus`.
            - **Executable**: `rider-app-exe` (entry point `server/Main.hs`).
        - **Beckn Integration**:
            - **`beckn-spec` library**: Defines Beckn protocol specifications, data types, core Servant API structures.
            - **`beckn-services` library**: Provides client implementations for interacting with external Beckn APIs (Servant client, `http-client`).
            - **`Beckn.ACL.IGM.*` modules**: Part of `beckn-spec` or a related ACL library, used for constructing Beckn IGM message payloads.
            - **`Beckn.ACL.Cancel` module**: (Part of `beckn-spec` or related ACL library) Used for constructing Beckn `cancel` message payloads (e.g., `ACL.buildCancelReqV2`).
            - **`Beckn.ACL.OnSearch` module**: (Part of `beckn-spec` or related ACL library) Contains `TaxiACL.buildOnSearchReqV2` for parsing `on_search` Beckn payloads.
            - **`Beckn.ACL.OnSelect` module**: (Part of `beckn-spec` or related ACL library) Contains `ACL.buildOnSelectReqV2` for parsing `on_select` Beckn payloads.
            - **`Beckn.ACL.OnInit` module**: (Part of `beckn-spec` or related ACL library) Contains `TaxiACL.buildOnInitReqV2` for parsing `on_init` and `ACL.buildConfirmReqV2` for building `confirm`.
            - **`Beckn.ACL.OnConfirm` module**: (Part of `beckn-spec` or related ACL library) Contains `ACL.buildOnConfirmReqV2` for parsing `on_confirm` Beckn payloads.
            - **`Beckn.ACL.OnStatus` module**: (Part of `beckn-spec` or related ACL library) Contains `ACL.buildOnStatusReqV2` for parsing `on_status` Beckn payloads.
            - **`Beckn.ACL.OnTrack` module**: (Part of `beckn-spec` or related ACL library) Contains `ACL.buildOnTrackReqV2` for parsing `on_track` Beckn payloads.
            - **`Beckn.ACL.OnUpdate` module**: (Part of `beckn-spec` or related ACL library) Contains `ACL.buildOnUpdateReqV2` for parsing the versatile `on_update` Beckn payloads into specific domain types.
            - **`Kernel.Utils.Servant.SignatureAuth`**: Provides the mechanism for verifying Beckn callback signatures.
        - **Rule Engine & Policy Enforcement (`yudhishthira` library)**:
            - Central hub for evaluating complex business rules and policies. Uses `json-logic-hs`, Namma DSL, `haskell-cac`, `passetto-client`.
        - **External Service Integrations (`external` library)**:
            - Manages integrations with third-party services including Telephony Providers, AWS SES/SNS (for email/SMS/push indirectly), Slack, Chat AI, external logging, SMS gateways, Kapture CRM, Social Media Providers, Real-time Public Transport Data Feeds, POI/Place Search APIs, Mapping Services, Aadhaar Verification Services, Google Translate API, and WhatsApp Business API Providers. Also, **Firebase Cloud Messaging (FCM)** for push notifications (potentially via `API.Action.UI.TriggerFCM` or direct use within notification logic).
        - **Metrics Collection (`sessionizer-metrics` library)**:
            - Collects and exposes session-based operational metrics via Prometheus. Depends on `mobility-core`.
        - **Inbound Webhook Handling (`webhook` library)**:
            - Receives, validates, and processes incoming webhook notifications. Namma DSL for API/storage, Servant, Beam for PostgreSQL, `cryptohash`, `mobility-core`.
        - **Message Production (`producer` library & `producer-exe`)**:
            - Generates messages (likely for Kafka) for asynchronous processing. Uses Beam for PostgreSQL, Redis, and depends on `mobility-core`.
        - **Shared Platform Services (`shared-services` library)**:
            - Common functionalities (Registry, Issue Management, URL Shortener, ConfigPilotFrontend).
            - Servant APIs, Beam for PostgreSQL, `http-client`, Namma DSL.
            - **`IssueManagement` library (Shared Component)**: Provides generic issue management API structure (`IssueManagement.API.UI.Issue`) and common domain logic (`IssueManagement.Common.UI.Issue`, `IssueManagement.Domain.Action.UI.Issue`). Relies on an adapter (`ServiceHandle`) for context-specific data and actions.
        - **Location Processing (`location-updates` library)**:
            - // ... (existing content) ...
        - **Geographic Zone Management (`special-zone-a` library)**:
            - // ... (existing content) ...
        - **Payment Processing (`payment` library)**:
            - // ... (existing content) ...
        - **Task Scheduling (`scheduler` library)**:
            - // ... (existing content) ...
        - **General Utilities (`utils` library)**:
            - // ... (existing content) ...
        - **Internal Communication Logic**:
            - `Domain.Action.Internal.DriverArrivalNotf`: Contains logic for driver arrival notification processing.
            - // ... (other existing content) ...
        - **External System Interface Modules**: 
            - `Kernel.External.GoogleTranslate.Types`: Defines types like `TranslateResp` for Google Translate API interactions.
            - // ... (other existing content) ...
        - **Kafka Consumers (`kafka-consumers` service)**:
            - // ... (existing content) ...
        - **General Backend & API Development**:
            - // ... (existing content) ...
        - **Core & Shared Logic (dependencies of various libs/services)**:
            - `Maps.Language`: Type used for specifying languages in Google Translate requests, likely shared with mapping functionalities.
            - `Domain.Types.Disability`: Defines the `Disability` type used by `API.UI.Disability`.
            - `Domain.Types.CancellationReason`: Defines `CancellationStage` and `CancellationReasonAPIEntity` used by `API.UI.CancellationReason`.
            - `Domain.Action.UI.PersonStats`: Contains types like `PersonStatsRes`.
            - `Domain.Action.UI.Whatsapp`: Contains the type `OptAPIRequest` and the core logic for WhatsApp opt-in/out.
            - `Domain.Types.DeletedPerson`: (Namma DSL generated) Defines the type for deleted person records, used by `Storage.Beam.DeletedPerson`.
            - `Storage.Beam.DeletedPerson`: (Namma DSL generated) Defines the database schema and queries for managing deleted person records.
            - // ... (other existing content) ...

- **Dynamic Offer Driver Application (`dynamic-offer-driver-app` from `Backend/app/provider-platform/dynamic-offer-driver-app/Main/`):
    - **Purpose**: Core Beckn Provider Platform (BPP) application for drivers, focusing on dynamic offers.
    - **Framework**: `euler-hs`.
    - **API Implementation**: Servant (including `servant-openapi3` for documentation).
    - **Database**: PostgreSQL with Beam ORM (`beam-core`, `beam-postgres`, `esqueleto`, `postgresql-simple`).
    - **Authentication**: `passetto-client` (likely for driver sessions).
    - **Beckn Integration**: `beckn-spec` and `beckn-services` for BPP functionalities.
    - **Key NammaYatri Shared Libraries Used**:
        - `mobility-core`: Core platform functionalities.
        - `haskell-cac`: Configuration as Code.
        - `location-updates`: Processing driver location data.
        - `special-zone-a`: Utilizing geographic zone configurations.
        - `payment`: Handling driver payment/payout aspects.
        - `sessionizer-metrics`: For operational metrics.
        - `webhook`: For webhook interactions.
        - `utils`: Common platform utilities.
        - `external`: External service integrations.
        - `yudhishthira`: Rule engine for dynamic offers/pricing.
        - `scheduler`: For scheduled tasks.
        - `dashboard-helper-api`, `shared-services`: Integration with dashboard and other common services.
        - `dashcam`: Potential dashcam feature integration.
    - **Geospatial**: `geohash`.
    - **Image Processing**: `JuicyPixels`.
    - **Metrics**: `prometheus-client`.
    - **Build & Tooling**: Namma DSL for code generation (implied by `src-read-only` and common platform pattern), `RecordDotPreprocessor`, `TemplateHaskell`, links `cac_client` library.
    - **Executable**: `dynamic-offer-driver-app-exe` (entry point `server/Main.hs`).
    - **Beckn Protocol Handling (BPP - Provider Side)**:
        - **Search Request Processing (`API.Beckn.Search.hs`)**:
            - **Endpoint**: Handles Beckn `/search` requests (e.g., `POST /v2/beckn/{merchantId}/search`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization and X-Gateway-Authorization headers).
            - **Request/Response Types**: Receives `Search.SearchReqV2`, sends `on_search` callbacks with `OnSearch.OnSearchReqV2` payload (or `AckResponse` immediately).
            - **Core Logic Delegation**: `Domain.Action.Beckn.Search.handler` is responsible for finding drivers, applying dynamic pricing, and generating quotes.
            - **Key Technologies/Patterns**: 
                - Asynchronous processing using `fork`.
                - Redis for idempotency locks (`searchLockKey`, `searchProcessingLockKey`).
                - `yudhishthira` rule engine and `special-zone-a` for dynamic offer generation.
                - `Callback.withCallback` for sending asynchronous `on_search` responses to BAP URIs.
                - Conditional quote sending based on "Value Add NP" status of BAP (`VNP.isValueAddNP`).
                - Logging to `TransactionLogs` for ONDC.
            - **Internal Data Transformation**: `Beckn.ACL.Search.buildSearchReqV2` (to transform incoming Beckn) and `Beckn.ACL.OnSearch.mkOnSearchRequest` (to construct outgoing `on_search`).
        - **Select Request Processing (`API.Beckn.Select.hs`)**:
            - **Endpoint**: Handles Beckn `/select` requests (e.g., `POST /v2/beckn/{merchantId}/select`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Select.SelectReqV2`, sends `on_select` callbacks (payload structure defined by Beckn `OnSelect` types, likely via `ACL.mkOnSelectRequest` though not explicitly in this file) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Select.validateRequest` (validates against `Merchant`, `SearchRequest`, `Estimate` entities) and `Domain.Action.Beckn.Select.handler` (confirms availability, may lock resources, prepares `on_select` data).
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency locks (`selectLockKey`, `selectProcessingLockKey`).
                - Interaction with persisted `SearchRequest` and `Estimate` entities.
                - Asynchronous `on_select` callback to BAP URI (likely via `Callback.withCallback` called within `DSelect.handler`).
            - **Internal Data Transformation**: `Beckn.ACL.Select.buildSelectReqV2` (to transform incoming Beckn `SelectReqV2` into internal `DSelect.DSelectReq`).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Init Request Processing (`API.Beckn.Init.hs`)**:
            - **Endpoint**: Handles Beckn `/init` requests (e.g., `POST /v2/beckn/{merchantId}/init`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Init.InitReqV2`, sends `on_init` callbacks with `OnInit.OnInitReq` (containing `Spec.OnInitMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Init.validateRequest` (validates against `Merchant`, confirmed `Estimate`) and `Domain.Action.Beckn.Init.handler` (creates preliminary `Booking`, finalizes terms, prepares `on_init` data).
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`initLockKey`, `initProcessingLockKey`, `initProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_init` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_init` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_init` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Init.buildInitReqV2` (to transform incoming Beckn `InitReqV2` into internal `DInit.DInitReq`) and `Beckn.ACL.OnInit.mkOnInitMessageV2` (to construct outgoing `on_init` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Confirm Request Processing (`API.Beckn.Confirm.hs`)**:
            - **Endpoint**: Handles Beckn `/confirm` requests (e.g., `POST /v2/beckn/{merchantId}/confirm`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Confirm.ConfirmReqV2`, sends `on_confirm` callbacks with `OnConfirm.OnConfirmReq` (containing `Spec.OnConfirmMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Confirm.validateRequest` (validates against `Merchant`, confirmed `Estimate`) and `Domain.Action.Beckn.Confirm.handler` (finalizes `Booking`, prepares `on_confirm` data).
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`confirmLockKey`, `confirmProcessingLockKey`, `confirmProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_confirm` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_confirm` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_confirm` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Confirm.buildConfirmReqV2` (to transform incoming Beckn `ConfirmReqV2` into internal `DConfirm.DConfirmReq`) and `Beckn.ACL.OnConfirm.mkOnConfirmMessageV2` (to construct outgoing `on_confirm` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Track Request Processing (`API.Beckn.Track.hs`)**:
            - **Endpoint**: Handles Beckn `/track` requests (e.g., `POST /v2/beckn/{merchantId}/track`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Track.TrackReqV2`, sends `on_track` callbacks with `OnTrack.OnTrackReq` (containing `Spec.OnTrackMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Track.handler` is responsible for tracking the ride and updating the status.
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`trackLockKey`, `trackProcessingLockKey`, `trackProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_track` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_track` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_track` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Track.buildTrackReqV2` (to transform incoming Beckn `TrackReqV2` into internal `DTrack.DTrackReq`) and `Beckn.ACL.OnTrack.mkOnTrackMessageV2` (to construct outgoing `on_track` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Cancel Request Processing (`API.Beckn.Cancel.hs`)**:
            - **Endpoint**: Handles Beckn `/cancel` requests (e.g., `POST /v2/beckn/{merchantId}/cancel`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Cancel.CancelReqV2`, sends `on_cancel` callbacks with `OnCancel.OnCancelReq` (containing `Spec.OnCancelMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Cancel.validateRequest` (validates against `Merchant`, confirmed `Estimate`) and `Domain.Action.Beckn.Cancel.handler` (finalizes `Booking`, prepares `on_cancel` data).
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`cancelLockKey`, `cancelProcessingLockKey`, `cancelProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_cancel` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_cancel` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_cancel` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Cancel.buildCancelReqV2` (to transform incoming Beckn `CancelReqV2` into internal `DCancel.DCancelReq`) and `Beckn.ACL.OnCancel.mkOnCancelMessageV2` (to construct outgoing `on_cancel` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Rating Request Processing (`API.Beckn.Rating.hs`)**:
            - **Endpoint**: Handles Beckn `/rating` requests (e.g., `POST /v2/beckn/{merchantId}/rating`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Rating.RatingReqV2`, sends `on_rating` callbacks with `OnRating.OnRatingReq` (containing `Spec.OnRatingMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Rating.handler` is responsible for handling post-ride feedback.
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`ratingLockKey`, `ratingProcessingLockKey`, `ratingProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_rating` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_rating` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_rating` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Rating.buildRatingReqV2` (to transform incoming Beckn `RatingReqV2` into internal `DRating.DRatingReq`) and `Beckn.ACL.OnRating.mkOnRatingMessageV2` (to construct outgoing `on_rating` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Update Request Processing (`API.Beckn.Update.hs`)**:
            - **Endpoint**: Handles Beckn `/update` requests (e.g., `POST /v2/beckn/{merchantId}/update`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Update.UpdateReqV2`, sends `on_update` callbacks with `OnUpdate.OnUpdateReq` (containing `Spec.OnUpdateMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Update.validateRequest` (validates against `Merchant`, confirmed `Estimate`) and `Domain.Action.Beckn.Update.handler` (finalizes `Booking`, prepares `on_update` data).
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`updateLockKey`, `updateProcessingLockKey`, `updateProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_update` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_update` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_update` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Update.buildUpdateReqV2` (to transform incoming Beckn `UpdateReqV2` into internal `DUpdate.DUpdateReq`) and `Beckn.ACL.OnUpdate.mkOnUpdateMessageV2` (to construct outgoing `on_update` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
        - **Status Request Processing (`API.Beckn.Status.hs`)**:
            - **Endpoint**: Handles Beckn `/status` requests (e.g., `POST /v2/beckn/{merchantId}/status`).
            - **Authentication**: Beckn `SignatureAuth` (Authorization header from BAP).
            - **Request/Response Types**: Receives `Status.StatusReqV2`, sends `on_status` callbacks with `OnStatus.OnStatusReq` (containing `Spec.OnStatusMessage`) or `AckResponse` immediately.
            - **Core Logic Delegation**: `Domain.Action.Beckn.Status.handler` is responsible for handling status updates.
            - **Key Technologies/Patterns**:
                - Asynchronous processing using `fork`.
                - Redis for idempotency and state management (`statusLockKey`, `statusProcessingLockKey`, `statusProcessedKey` based on `fulfillmentId`).
                - Uses `BecknConfig` for TTLs for the `on_status` context.
                - Interacts with fare policy logic (`SharedLogic.FarePolicy.getFarePolicyByEstOrQuoteIdWithoutFallback`).
                - Asynchronous `on_status` callback to BAP URI via `Callback.withCallback`.
                - Robust error handling, including attempts to cancel the BPP-side preliminary booking if `on_status` send fails (`SharedLogic.Booking.cancelBooking`).
            - **Internal Data Transformation**: `Beckn.ACL.Status.buildStatusReqV2` (to transform incoming Beckn `StatusReqV2` into internal `DStatus.DStatusReq`) and `Beckn.ACL.OnStatus.mkOnStatusMessageV2` (to construct outgoing `on_status` message body).
            - **Logging**: To `TransactionLogs` for ONDC.
    - **Driver UI APIs (`API.UI.hs` - mounted under `/ui/`)**:
        - **Driver Registration & Authentication (`API.UI.Registration.hs`)**:
            - **Purpose**: Handles driver initial login and registration via OTP.
            - **Endpoints (all under `/ui/auth/`)**:
                - `POST /`: Initiate OTP. Takes `DRegistration.AuthReq` (driver identifier like phone), client context headers (`x-bundle-version`, etc.). Returns `DRegistration.AuthRes` (`authId`).
                - `POST /{authId}/verify`: Verify OTP. Takes `DRegistration.AuthVerifyReq` (OTP). Returns `DRegistration.AuthVerifyRes` (session token, driver profile context including `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
                - `POST /otp/{authId}/resend`: Resend OTP. Returns `DRegistration.ResendAuthRes`.
                - `POST /logout`: Logout an authenticated driver. Requires `TokenAuth`.
            - **Authentication**: Initial steps are unauthenticated; `/logout` uses `TokenAuth` (driver's Passetto session token).
            - **State Management**: Uses `RegistrationToken` (likely stored in Redis) to manage OTP attempts.
            - **Delegation**: All handlers delegate to functions in `Domain.Action.UI.Registration` (the `dynamic-offer-driver-app`'s version).
        - **Detailed Driver Onboarding (`API.Action.UI.DriverOnboardingV2.hs`)** (Namma DSL generated):
            - **Purpose**: Manages the comprehensive onboarding process for drivers after initial authentication.
            - **Endpoints (all under `/v2/ui/...` and require `TokenAuth`)**:
                - `GET /onboarding/configs`: Fetches dynamic document/verification configurations. Params: `makeSelfieAadhaarPanMandatory` (Bool), `onlyVehicle` (Bool). Returns `DocumentVerificationConfigList`.
                - `GET /driver/rateCard`: Views applicable rate cards. Params: `distance` (Meters), `durationInMin` (Minutes), `tripCategory`, `vehicleServiceTier`. Returns `[RateCardResp]`.
                - `GET /driver/vehiclePhotos` & `GET /driver/vehiclePhotosB64`: Retrieve vehicle photos by RC number, with various view flags (front, back, etc.). Returns `VehiclePhotosResp`.
                - `POST /driver/updateAirCondition`: Updates vehicle AC status. Takes `UpdateAirConditionUpdateRequest`.
                - `GET /driver/vehicleServiceTiers`: Fetches driver's vehicle service tiers. Returns `DriverVehicleServiceTiers`.
                - `POST /driver/updateServiceTiers`: Updates driver's vehicle service tiers. Takes `DriverVehicleServiceTiers`.
                - `POST /driver/register/ssn`: Submits SSN/equivalent. Takes `SSNReq`.
                - `POST /driver/backgroundVerification`: Initiates/checks background verification.
                - `POST /driver/register/pancard`: Submits PAN card details. Takes `DriverPanReq`.
                - `GET /driver/register/bankAccount/link`: Gets bank account linking info/URL. Returns `BankAccountLinkResp`.
                - `GET /driver/register/bankAccount/status`: Checks bank account verification status. Returns `BankAccountResp`.
                - `GET /driver/register/getLiveSelfie`: Retrieves a live selfie. Param: `status` (`SelfieFetchStatus`). Returns `GetLiveSelfieResp`.
                - `POST /driver/register/aadhaarCard`: Submits Aadhaar card details. Takes `AadhaarCardReq`.
                - `POST /driver/register/logHvSdkCall`: Logs a call to an external KYC/verification SDK (e.g., HyperVerge). Takes `HVSdkCallLogReq`.
            - **Delegation**: All handlers delegate to functions in `Domain.Action.UI.DriverOnboardingV2`.
            - **Key Data Types**: Uses various request/response types from `API.Types.UI.DriverOnboardingV2`, `Domain.Types.Common`, `Domain.Types.Image`.
            - **External Integrations**: Implies integration with KYC SDKs (e.g., HyperVerge for liveness/document checks).
        - **Core Driver Operations (`API.UI.Driver.hs`)**: // ... (existing detailed content) ...
        - **Demand Hotspot Retrieval (`API.Action.UI.DemandHotspots.hs`)**: // ... (existing detailed content) ...
        - **Driver Profile Summary Retrieval (`API.UI.DriverProfileSummary.hs`)** (Source file):
            - **Purpose**: Fetches a summary of the authenticated driver's profile.
            - **Endpoint**: `GET /v2/ui/driver/profile/summary`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request**: Optional query param `fleetInfo` (Bool).
            - **Response**: `Domain.DriverProfleSummaryRes` (from `Domain.Action.UI.DriverProfileSummary`).
            - **Delegation**: Handler `getDriverProfileSummary` delegates to `Domain.Action.UI.DriverProfileSummary.getDriverProfileSummary`.
            - **Logic**: Domain action fetches driver profile and optional fleet information from DB.
        - **Driver Referral Program Management (`API.UI.DriverReferral.hs`)**: // ... (existing detailed content) ...
        - **Driver-Side Payment Operations (`API.UI.Payment.hs`)**: // ... (existing detailed content) ...
        - **Driver Referral Payout Management (`API.Action.UI.ReferralPayout.hs`)**: // ... (existing detailed content) ...
        - **Driver Performance Retrieval (`API.UI.Performance.hs`)** (Source file):
            - **Purpose**: Fetches performance metrics for the authenticated driver.
            - **Endpoint**: `GET /v2/ui/driver/performance`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Response**: `Domain.PerformanceRes` (from `Domain.Action.UI.Performance`), containing aggregated KPIs like ride counts, ratings, earnings.
            - **Delegation**: Handler `getDriverPerformance` delegates to `Domain.Action.UI.Performance.getDriverPerformance`.
            - **Logic**: Domain action queries and aggregates data from various DB tables (rides, ratings, earnings) to compute metrics.
        - **Driver Messaging (`API.UI.Message.hs`)** (Source file):
            - **Purpose**: Manages in-app messaging for drivers.
            - **Endpoints (all under `/v2/ui/message/` and require `TokenAuth`)**: `GET /list` (pagination params), `GET /{messageId}`, `PUT /{messageId}/seen`, `PUT /{messageId}/like`, `PUT /{messageId}/response` (takes `DMessage.MessageReplyReq`), `GET /media` (param `filePath`).
            - **Response Types**: `[DMessage.MessageAPIEntityResponse]`, `DMessage.MessageAPIEntityResponse`, `APISuccess`, `Text` (for media).
            - **Delegation**: All handlers delegate to functions in `Domain.Action.UI.Message`.
        - **Exotel-Triggered End Ride (`API.UI.ExotelEndRide.hs`)** (Source file):
            - **Purpose**: Allows ending a ride via an Exotel call.
            - **Endpoint**: `GET /v2/ui/exotel/ride/end`.
            - **Authentication**: Implicit via `CallFrom` and `CallTo` (Exotel number mapped to merchant/city via `Exophone` config).
            - **Request**: Query params `CallFrom` (Text), `CallTo` (Text).
            - **Response**: `DExotelEndRide.AckResp`.
            - **Delegation**: Handler `callBasedEndRide` delegates to `Domain.Action.UI.ExotelEndRide.callBasedEndRide` (uses `CQExophone.findByEndRidePhone`).
        - **Merchant-Specific City Listing (`API.UI.City.hs`)** (Source file):
            - **Purpose**: Fetches a list of operational cities for a given merchant.
            - **Endpoint**: `GET /v2/ui/city/{merchantId}/list`.
            - **Authentication**: Requires `TokenAuth` (driver/admin context likely providing implicit or explicit `merchantId`).
            - **Path Parameter**: `merchantId` (`Id DM.Merchant`).
            - **Response**: `[DTC.CityRes]` (list of city details from `Domain.Types.City`).
            - **Delegation**: Handler `listCities` delegates to `Domain.Action.UI.City.listCities`.
            - **Logic**: Domain action queries database (e.g., `MerchantOperatingCity` table) for cities linked to the merchant.
        - **Kiosk Location Listing (`API.UI.KioskLocation.hs`)** (Source file):
            - **Purpose**: Fetches a list of designated kiosk locations relevant to the driver's operational context.
            - **Endpoint**: `GET /v2/ui/kioskLocation/list`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Response**: `DKioskLocation.KioskLocationRes` (list of kiosk details from `Domain.Action.UI.KioskLocation`).
            - **Delegation**: Handler `listKioskLocations` delegates to `Domain.Action.UI.KioskLocation.listKioskLocations`.
            - **Logic**: Domain action queries a database/configuration for kiosk locations associated with the driver's merchant and city.
        - **Driver Leaderboards (`API.UI.LeaderBoard.hs`)**: // ... (existing detailed content from a previous turn) ...
        - **FCM Notification Trigger (OnMessage) (`API.UI.OnMessage.hs`)** (Source file):
            - **Purpose**: Triggers FCM push notifications to drivers, often based on message events.
            - **Endpoint**: `POST /v2/ui/onMessage`.
            - **Authentication**: Requires `TokenAuth` (driver session).
            - **Request/Response**: Takes `Dfcm.FCMReq` (notification details). Returns `APISuccess.APISuccess`.
            - **Delegation**: Handler `sendMessageFCM` delegates to `Domain.Action.UI.OnMessage.sendMessageFCM`.
            - **Logic**: Domain action constructs and dispatches FCM message via an external FCM service (likely via `external` library).
        - **Ride-Specific Route Info for Drivers (`API.UI.RideRoute.hs`)** (Source file):
            - **Purpose**: Fetches route geometry and details for a driver's assigned/active ride.
            - **Endpoint**: `POST /v2/ui/{rideId}/route`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Path Parameter**: `rideId` (`Id Ride.Ride`).
            - **Response**: `RouteInfo` (from `Domain.Types.RideRoute`), containing polyline, waypoints, distance, ETA.
            - **Delegation**: Handler `rideRoute` delegates to `Domain.Action.UI.RideRoute.rideRoute`.
            - **Logic**: Domain action fetches ride waypoints (from DB), potentially driver's current location, and calls an external mapping service (via `Kernel.External.Maps.Interface`) to compute the route.
        - **Driver Plan Management (`API.UI.Plan.hs`)** (Source file):
            - **Purpose**: Manages driver subscription plans.
            - **Endpoints (all under `/v2/ui/plan/` and require `TokenAuth`)**: `GET /list` (params `limit`, `offset`, `vehicleVariant`, `serviceName`), `PUT /suspend` (param `serviceName`), `PUT /resume` (param `serviceName`), `GET /currentPlan` (param `serviceName`), `POST /{planId}/subscribe` (param `serviceName`), `PUT /{planId}/select` (param `serviceName`), `GET /services`.
            - **Key Data Types**: `DPlan.PlanListAPIRes`, `APISuccess`, `DPlan.CurrentPlanRes`, `DPlan.PlanSubscribeRes`, `DPlan.ServicesEntity`.
            - **Delegation**: All handlers delegate to functions in `Domain.Action.UI.Plan` (e.g., `planList`, `planSuspend`, `planSubscribe`). Some interactions with `Domain.Action.UI.Driver` for dues.
        - **Driver Coins/Rewards Management (`API.UI.DriverCoins.hs`)** (Source file):
            - **Purpose**: Manages driver coin/reward balances and transactions.
            - **Endpoints (all under `/v2/ui/coins/` and require `TokenAuth`)**: `GET /transactions` (param `date`), `GET /usageHistory` (params `limit`, `offset`), `POST /convertCoinToCash` (takes `ConvertCoinToCashReq`), `GET /rideStatusPastDays`, `GET /info`.
            - **Key Data Types**: `Domain.CoinTransactionRes`, `Domain.CoinsUsageRes`, `APISuccess`, `Domain.RideStatusPastDaysRes`, `Domain.CoinInfoRes`.
            - **Delegation**: All handlers delegate to functions in `Domain.Action.UI.DriverCoin`.
        - **Driver Ride Summaries (`API.UI.RideSummary.hs`)** (Source file):
            - **Purpose**: Fetches summaries of a driver's completed rides for specified dates.
            - **Endpoint**: `POST /v2/ui/rideSummary/list`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Body**: `[Day]` (a list of dates).
            - **Response**: `RDS.DriverRideSummaryListResp` (from `Domain.Action.UI.RideSummary`), containing aggregated ride data.
            - **Delegation**: Handler `listDailyStats` delegates to `Domain.Action.UI.RideSummary.listDailyRidesSummary`.
            - **Logic**: Domain action queries DB for driver's rides on specified dates and aggregates key metrics (earnings, counts).
        - **General Route Calculation for Drivers (`API.UI.Route.hs`)** (Source file):
            - **Purpose**: Provides general-purpose route calculation for drivers.
            - **Endpoints (all `POST`, under `/v2/ui/` and require `TokenAuth`)**:
                - `/route` (general route)
                - `/pickup/route` (route to pickup)
                - `/trip/route` (route for an entire trip)
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Body**: `Maps.GetRoutesReq` (from `Kernel.External.Maps`), containing origin, destination, optional waypoints, and route preferences.
            - **Response Type**: `Maps.GetRoutesResp` (from `Kernel.External.Maps`), containing polyline, distance, ETA, etc.
            - **Delegation**: Handlers delegate to `DRoute.getRoutes`, `DRoute.getPickupRoutes`, and `DRoute.getTripRoutes` in `Domain.Action.UI.Route`.
            - **Logic**: Domain actions interact with an external mapping service (likely via `Kernel.External.Maps.Interface`) using the `Maps.GetRoutesReq`.
        - **Driver Issue Reporting (including SOS/Emergency) (`API.UI.Issue.hs`)** (Source file):
            - **Purpose**: Provides structured issue reporting for drivers, including safety/SOS concerns, by leveraging a shared `IssueManagement` library.
            - **Endpoints**: Standard issue management APIs under `/v2/ui/issue/` (e.g., `POST /` to create, `GET /list`, `GET /category/list`, `GET /option/list`, `POST /media/upload`), as defined by `IssueManagement.API.UI.Issue.IssueAPI`.
            - **Authentication**: Requires `TokenAuth` (driver session).
            - **Delegation & Shared Library Usage**:
                - Handlers delegate to `IssueManagement.Common.UI.Issue` functions, passing a `driverIssueHandle`.
                - `driverIssueHandle :: IssueManagement.Common.UI.Issue.ServiceHandle Flow` adapts the generic library:
                    - Implements functions to find/fetch `dynamic-offer-driver-app` entities (Person, Ride, Merchant, Booking, MerchantOperatingCity) using local `Storage.Queries.*` and casts them to common types required by the `IssueManagement` library.
                    - Implements `createTicket` and `updateTicket` by calling `Tools.Ticket.createTicket` and `Tools.Ticket.updateTicket` with the driver app's merchant/city context.
                    - `buildMerchantConfig` fetches `TransporterConfig` (via `Storage.Cac.TransporterConfig`) to provide media limits, Kapture CRM settings, etc.
            - **SOS/Emergency**: Handled by drivers selecting pre-configured critical issue categories/options; subsequent alerting and escalation are managed by the `IssueManagement` domain logic.
            - **Key Data Types**: Uses types from `IssueManagement.Common.UI.Issue` and `IssueManagement.Domain.Types.*` (e.g., `Common.IssueReportReq`, `Common.IssueReportRes`, `Domain.IssueCategory`).
        - **Driver Vehicle Details Management (`API.Action.UI.VehicleDetails.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Manages driver vehicle information, crucial for onboarding and compliance.
            - **Endpoints (all under `/v2/ui/` and require `TokenAuth`)**:
                - `GET /vehicleMakes`: Fetches list of vehicle manufacturers.
                - `POST /vehicleModels`: Fetches list of models for a given make.
                - `POST /vehicleDetails`: Submits/updates comprehensive vehicle details.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request/Response Types**:
                - `GET /vehicleMakes`: Returns `API.Types.UI.VehicleDetails.VehicleMakesResp`.
                - `POST /vehicleModels`: Takes `API.Types.UI.VehicleDetails.VehicleModelsReq` (contains make); returns `API.Types.UI.VehicleDetails.VehicleModelsResp`.
                - `POST /vehicleDetails`: Takes `API.Types.UI.VehicleDetails.VehicleDetailsReq` (comprehensive vehicle attributes); returns `Domain.Types.VehicleDetails.VehicleDetails` (the persisted vehicle record).
            - **Delegation**: Handlers delegate to `Domain.Action.UI.VehicleDetails.getVehicleMakes`, `Domain.Action.UI.VehicleDetails.postVehicleModels`, and `Domain.Action.UI.VehicleDetails.postVehicleDetails`.
            - **Logic**: Domain actions fetch make/model lists from configured data sources (DB/static config) and process/store detailed vehicle attributes (registration, insurance, etc.) linked to the driver's profile.
        - **Dynamic UI Configuration Retrieval (CaC) (`API.Action.UI.Cac.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Enables remote management of driver app UI features and appearance (Configuration-as-Code).
            - **Endpoint**: `POST /v2/ui/driver/getUiConfigs`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request**: 
                - Query Parameters: `toss` (Optional `Int` for A/B testing), `tenant` (Optional `Text`).
                - Body: `Data.Aeson.Object` (flexible JSON object for client-specific context like app version, device info, current flags).
            - **Response**: `Data.Aeson.Object` (JSON object containing the tailored UI configurations - feature flags, themes, text, etc.).
            - **Delegation**: Handler `postDriverGetUiConfigs` delegates to `Domain.Action.UI.Cac.postDriverGetUiConfigs`.
            - **Logic**: The domain action uses the provided context (driver, merchant, city, toss group, tenant, client state) to query a configuration management system (potentially involving `ConfigPilotFrontend` shared service) and returns the relevant UI configurations.
        - **Driver Call Feedback Submission (`API.Action.UI.CallFeedback.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to submit feedback on platform-mediated calls.
            - **Endpoint**: `POST /v2/ui/driver/call/feedback`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Body**: `API.Types.UI.CallFeedback.CallFeedbackReq` (containing call ID, rating, feedback category, comments).
            - **Response**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `postDriverCallFeedback` delegates to `Domain.Action.UI.CallFeedback.postDriverCallFeedback`.
            - **Logic**: The domain action validates and stores the call feedback, linking it to the relevant call record for quality monitoring.
        - **Dynamic Driver Profile Questions (`API.Action.UI.DriverProfileQuestions.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Enables flexible data collection from drivers via dynamically defined questions (e.g., for onboarding, profile updates).
            - **Endpoints (all under `/v2/ui/DriverProfileQues` and require `TokenAuth`)**:
                - `GET /`: Fetches the list of profile questions for the driver.
                - `POST /`: Submits the driver's answers to the profile questions.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request/Response Types**:
                - `GET`: Query parameter `isImages` (Optional `Bool`). Returns `API.Types.UI.DriverProfileQuestions.DriverProfileQuesRes` (list of questions, types, options).
                - `POST`: Takes `API.Types.UI.DriverProfileQuestions.DriverProfileQuesReq` (question IDs and answers). Returns `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handlers `getDriverProfileQues` and `postDriverProfileQues` delegate to corresponding functions in `Domain.Action.UI.DriverProfileQuestions`.
            - **Logic**: Domain actions fetch questions based on driver context (from a configuration source like DB or CaC system) and process/store submitted answers.
        - **Driver Response to Booking Edits (`API.Action.UI.EditBooking.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to accept or reject proposed in-ride booking modifications (e.g., destination change).
            - **Endpoint**: `POST /v2/ui/edit/result/{bookingUpdateRequestId}`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Path Parameter**: `bookingUpdateRequestId` (`Id Domain.Types.BookingUpdateRequest.BookingUpdateRequest`).
            - **Request Body**: `API.Types.UI.EditBooking.EditBookingRespondAPIReq` (containing driver's decision, e.g., ACCEPT/REJECT).
            - **Response**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `postEditResult` delegates to `Domain.Action.UI.EditBooking.postEditResult`.
            - **Logic**: The domain action validates the driver's response, updates the status of the `BookingUpdateRequest` and potentially the `Ride` details. It may also trigger notifications to the BAP/rider about the outcome.
        - **Fare Calculation/Estimation for Drivers (`API.Action.UI.FareCalculator.hs`)**: // ... (existing detailed content from a previous turn) ...
        - **Driver-Side Insurance Details Retrieval (`API.Action.UI.Insurance.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to fetch insurance details for a given reference ID (e.g., ride ID, policy ID).
            - **Endpoint**: `GET /v2/ui/insurance/{referenceId}`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Path Parameter**: `referenceId` (`Text`).
            - **Response Type**: `SharedLogic.CallBAPInternal.InsuranceAPIEntity` (contains structured insurance policy information).
            - **Delegation**: Handler `getInsurance` delegates to `Domain.Action.UI.Insurance.getInsurance`.
            - **Logic**: The domain action validates the `referenceId` and likely calls an internal service (suggested by `SharedLogic.CallBAPInternal`) to fetch the insurance details from a centralized source.
        - **Driver Invoice Retrieval (Filtered) (`API.Action.UI.Invoice.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to fetch their invoices with filters for date range and vehicle RC number.
            - **Endpoint**: `GET /v2/ui/invoice`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Query Parameters**: `fromDate` (Optional `Kernel.Prelude.UTCTime`), `toDate` (Optional `Kernel.Prelude.UTCTime`), `rcNo` (Optional `Kernel.Prelude.Text`).
            - **Response Type**: `[API.Types.UI.Invoice.InvoiceRes]` (list of invoice details).
            - **Delegation**: Handler `getInvoice` delegates to `Domain.Action.UI.Invoice.getInvoice`.
            - **Logic**: The domain action queries the database for invoices matching the driver's ID and the provided filters (date range, RC number) and returns formatted invoice data.
        - **Driver Learning Management System (LMS) (`API.Action.UI.LmsModule.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Provides a comprehensive learning platform (training modules, videos, quizzes, certificates, bonus coins) for drivers.
            - **Endpoints (all under `/v2/ui/lms/` and require `TokenAuth`)**:
                - `GET /listAllModules`: Filterable by `language`, `limit`, `moduleSection`, `offset`, `variant` (vehicle).
                - `GET /{moduleId}/listAllVideos`: Optional `language` param.
                - `GET /{moduleId}/listAllQuiz`: Optional `language` param.
                - `POST /markVideoAsStarted`: Takes `API.Types.UI.LmsModule.VideoUpdateAPIReq`.
                - `POST /markVideoAsCompleted`: Takes `API.Types.UI.LmsModule.VideoUpdateAPIReq`.
                - `POST /question/confirm`: Takes `API.Types.UI.LmsModule.QuestionConfirmReq`.
                - `GET /{moduleId}/getCertificate`.
                - `GET /getAllCertificates`.
                - `GET /{moduleId}/getBonusCoins`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Key Data/Response Types**: `API.Types.UI.LmsModule.LmsGetModuleRes`, `LmsGetVideosRes`, `LmsGetQuizRes`, `LmsCertificateRes`, `[CertificateInfo]`, `BonusRes`, `QuestionConfirmRes`, `APISuccess`.
            - **Delegation**: All handlers delegate to corresponding functions in `Domain.Action.UI.LmsModule`.
            - **Logic**: Domain actions manage learning content, track driver progress, handle quiz submissions, and issue certificates/bonus coins (linking to `DriverCoins` system).
        - **Driver-Contextual City Configurations Retrieval (`API.Action.UI.Merchant.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to fetch configurations specific to their current merchant and operating city.
            - **Endpoint**: `GET /v2/ui/cityConfigs`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Response Type**: `API.Types.UI.Merchant.CityConfigs` (a structured set of city-specific configurations).
            - **Delegation**: Handler `getCityConfigs` delegates to `Domain.Action.UI.Merchant.getCityConfigs`.
            - **Logic**: The domain action uses the driver's context (especially `MerchantOperatingCityId`) to fetch relevant configurations (operational parameters, UI settings, local feature flags) from a configuration store (DB or CaC system).
        - **Meter Ride Management (`API.Action.UI.MeterRide.hs`)**: // ... (existing detailed content from a previous turn) ...
        - **Driver Interaction with Operation Hubs (`API.Action.UI.OperationHub.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Manages driver interactions with operational hubs for service requests and tracking.
            - **Endpoints (all under `/v2/ui/operation/` and require `TokenAuth`)**:
                - `GET /getAllHubs`: Lists available operation hubs.
                - `POST /createRequest`: Submits a driver's request to an operation hub.
                - `GET /getRequests`: Retrieves a driver's request history.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request/Response Types**:
                - `GET /getAllHubs`: Returns `[Domain.Types.OperationHub.OperationHub]`.
                - `POST /createRequest`: Takes `API.Types.UI.OperationHub.DriverOperationHubRequest` (includes hub ID, request type, details, rcNo); returns `Kernel.Types.APISuccess.APISuccess`.
                - `GET /getRequests`: Query params: `mbFrom` (`UTCTime`), `mbTo` (`UTCTime`), `mbLimit` (`Int`), `mbOffset` (`Int`), `mbStatus` (`Domain.Types.OperationHubRequests.RequestStatus`), `mbReqType` (`Domain.Types.OperationHubRequests.RequestType`), `rcNo` (mandatory `Text`). Returns `API.Types.UI.OperationHub.OperationHubRequestsResp`.
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.OperationHub`.
            - **Logic**: Domain actions manage hub information, process new requests (linking to driver/vehicle), and retrieve request history with status updates from DB.
        - **Driver Consent to Operator Association (`API.Action.UI.Operator.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows authenticated drivers to consent to an association with a fleet operator.
            - **Endpoint**: `POST /v2/ui/operator/consent`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Body**: None (consent is implicit by the authenticated driver making the call).
            - **Response Type**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `postOperatorConsent` delegates to `Domain.Action.UI.Operator.postOperatorConsent`.
            - **Logic**: Domain action identifies a pending operator association for the driver (e.g., from `DriverOperatorAssociation` table in DB), activates it (e.g., sets `isActive = True`), potentially updates driver's onboarding status, and notifies relevant parties.
        - **Driver Fare Details (Meter Pricing & Price Breakup) (`API.Action.UI.PriceBreakup.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to finalize meter ride prices and get detailed fare breakdowns for any ride.
            - **Endpoints (require `TokenAuth`, likely under `/v2/ui/`)**:
                - `POST /meterRide/price`: Calculates/finalizes meter ride price. Takes `rideId` (QueryParam) and `API.Types.UI.PriceBreakup.MeterRidePriceReq` (Body). Returns `API.Types.UI.PriceBreakup.MeterRidePriceRes`.
                - `GET /priceBreakup`: Fetches detailed fare breakdown. Takes `rideId` (QueryParam). Returns `[API.Types.UI.DriverOnboardingV2.RateCardItem]`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Delegation**: Handlers `postMeterRidePrice` and `getPriceBreakup` delegate to corresponding functions in `Domain.Action.UI.PriceBreakup`.
            - **Logic**: Domain actions handle calculation/finalization of meter ride prices using submitted parameters and retrieve stored fare component data (rate card items) for general rides.
        - **Driver "Reels" (Short Video Content) Retrieval (`API.Action.UI.Reels.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to fetch short video content ("Reels") for engagement and information.
            - **Endpoint**: `GET /v2/ui/reels/getAllReelVideos`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Query Parameters**: `language` (Optional `Kernel.External.Types.Language`), `reelsKey` (Mandatory `Kernel.Prelude.Text` to categorize reels).
            - **Response Type**: `API.Types.UI.Reels.ReelsResp` (containing a list of reel objects with details like video URL, title, thumbnail).
            - **Delegation**: Handler `getReelsGetAllReelVideos` delegates to `Domain.Action.UI.Reels.getReelsGetAllReelVideos`.
            - **Logic**: Domain action queries a content store (CMS or DB) for reels matching the `reelsKey` and `language`, returning the list of videos.
        - **Driver Social Login & Profile Linking (`API.Action.UI.SocialLogin.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Enables driver sign-up/login via social media and linking of social accounts to existing platform profiles.
            - **Endpoints (likely under `/v2/ui/`)**:
                - `POST /social/login` (Unauthenticated): For social sign-up or login.
                - `POST /social/update/profile` (Authenticated with `TokenAuth`): For linking social account to an existing driver profile.
            - **Request Bodies**:
                - `/social/login`: `API.Types.UI.SocialLogin.SocialLoginReq` (contains social provider name, e.g., "google", and social provider's access token/auth code).
                - `/social/update/profile`: `API.Types.UI.SocialLogin.SocialUpdateProfileReq` (similar details for linking).
            - **Response Types**:
                - `/social/login`: `API.Types.UI.SocialLogin.SocialLoginRes` (contains platform session tokens, driver profile info, and registration/login status).
                - `/social/update/profile`: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handlers `postSocialLogin` and `postSocialUpdateProfile` delegate to corresponding functions in `Domain.Action.UI.SocialLogin`.
            - **Logic**: Domain actions interact with social media providers to validate tokens and fetch user details. For login, it creates a new driver profile or logs into an existing linked one. For profile update, it links the social identity to the authenticated driver's platform account.
        - **Driver Special Location Listing (`API.Action.UI.SpecialLocation.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Allows drivers to fetch a list of special operational locations (e.g., airports, malls) relevant to their context.
            - **Endpoint**: `GET /v2/ui/specialLocation/list`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Query Parameters**: `isOrigin` (Optional `Bool` to filter for pickup-allowed zones).
            - **Response Type**: `[Lib.Queries.SpecialLocation.SpecialLocationFull]` (list of detailed special location objects, likely including ID, name, geofence, type, rules).
            - **Delegation**: Handler `getSpecialLocationList` delegates to `Domain.Action.UI.SpecialLocation.getSpecialLocationList`.
            - **Logic**: The domain action queries a database/configuration (likely using `special-zone` library entities like `SpecialLocation`) for locations matching the driver's merchant/city and the `isOrigin` filter.
        - **Special Location "Warrior" Operations (`API.Action.UI.SpecialLocationWarrior.hs`)**: // ... (existing detailed content from a previous turn) ...
        - **Driver SDK Token for Payment Tokenization (`API.Action.UI.Tokenization.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Enables secure handling of driver payment information by providing temporary SDK tokens for client-side tokenization.
            - **Endpoint**: `GET /v2/ui/driver/sdkToken`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Query Parameters**: `expiry` (`Int`), `service` (`Kernel.External.Tokenize.TokenizationService` - e.g., "JUSPAY_TOKENIZER").
            - **Response Type**: `API.Types.UI.Tokenization.GetTokenRes` (contains the SDK token and its validity).
            - **Delegation**: Handler `getDriverSdkToken` delegates to `Domain.Action.UI.Tokenization.getDriverSdkToken`.
            - **Logic**: The domain action interacts with the specified external tokenization service (defined in `Kernel.External.Tokenize`) to generate and return a short-lived SDK token. The client application uses this token to initialize the provider's SDK for direct, secure tokenization of payment details.
        - **WMB/Fleet Operations & Managed Trips (`API.Action.UI.WMB.hs`)** (Namma DSL generated, in `src-read-only`):
            - **Purpose**: Manages functionalities for drivers operating in a fleet or managed service context ("WMB").
            - **Endpoints (all require `TokenAuth`, likely under `/v2/ui/`)**:
                - `GET /wmb/fleetBadges`: Lists fleet badges (filterable by `mbSearchString`, `mbBadgeType`, `limit`, `offset`).
                - `POST /wmb/availableRoutes`: Fetches available WMB routes (takes `API.Types.UI.WMB.AvailableRouteReq`).
                - `GET /wmb/route/{routeCode}/details`: Gets details for a specific WMB route.
                - `POST /wmb/qr/start`: Initiates a WMB trip via QR scan (takes `API.Types.UI.WMB.TripQrStartReq`).
                - `GET /wmb/trip/active`: Gets the current active WMB trip.
                - `GET /wmb/trip/list`: Lists past WMB trips (filterable by `limit`, `offset`, `status`).
                - `POST /wmb/trip/{tripTransactionId}/start`: Starts a WMB trip (takes `API.Types.UI.WMB.TripStartReq`).
                - `POST /wmb/trip/{tripTransactionId}/end`: Ends a WMB trip (takes `API.Types.UI.WMB.TripEndReq`).
                - `POST /wmb/trip/{tripTransactionId}/request`: Submits an operational request for a WMB trip (takes `API.Types.UI.WMB.RequestDetails`).
                - `GET /wmb/requests/{approvalRequestId}/status`: Gets status of an operational request.
                - `POST /wmb/requests/{approvalRequestId}/cancel`: Cancels an operational request.
                - `POST /fleet/consent`: Driver consents to fleet association.
                - `GET /fleet/config`: Gets fleet-specific configurations.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Key Data/Response Types**: Uses various types from `API.Types.UI.WMB`, `Domain.Types.FleetBadgeType`, `Domain.Types.TripTransaction`, `Domain.Types.AlertRequest`, `Domain.Types.FleetConfig`.
            - **Delegation**: All handlers delegate to corresponding functions in `Domain.Action.UI.WMB`.
            - **Logic**: Domain actions manage fleet/WMB specific routes, trip lifecycles, operational requests, fleet associations, and configurations stored in DB.
        - **Driver Call Management (`API.UI.Call.hs`)** (Source file):
            - **Purpose**: Manages voice call functionalities for drivers, integrating with Exotel and Twilio for masked PSTN calls and in-app VoIP.
            - **Endpoints (likely under `/v2/ui/`)**:
                - `POST /driver/ride/{rideId}/call/customer` (`TokenAuth`): Driver initiates backend call to customer for a ride.
                - `GET /driver/ride/{rideId}/call/{callId}/status` (`TokenAuth`): Driver polls for call status.
                - `POST /driver/ride/call/statusCallback`: Webhook for backend-initiated call status from telephony provider (e.g., Exotel).
                - `GET /exotel/call/customer/number`: Webhook for Exotel IVR to get customer number for masked call connection.
                - `GET /exotel/call/statusCallback`: Webhook for Exotel to report status of IVR-driven calls.
                - `GET /driver/register/call/driver` (`TokenAuth`): Driver initiates call, possibly for registration/verification (takes `RC` query param).
                - `GET /call/twillio/accessToken`: Provides Twilio SDK access token for VoIP (takes `bppRideId`, `user`, `deviceType`).
                - `GET /call/twillio/connectedEntityTwiml`: Provides TwiML for Twilio call control (takes `bppRideId`, `user`).
            - **Authentication**: Varies - `TokenAuth` for driver-initiated actions, unauthenticated for telephony provider webhooks.
            - **Key Data/Response Types**: `DCall.CallRes`, `DCall.GetCallStatusRes`, `DCall.CallCallbackReq`, `DCall.CallCallbackRes`, `DCall.GetCustomerMobileNumberResp`, `XmlText` (for TwiML).
            - **Delegation**: Handlers delegate to corresponding functions in `Domain.Action.UI.Call`.
            - **Logic**: Domain actions interact with telephony providers (Exotel, Twilio), manage call state (using `CallStatus` entity), ensure number masking, and provide necessary tokens/instructions for SDK-based calling.
        - **Driver Call Event Logging (`API.UI.CallEvent.hs`)** (Source file):
            - **Purpose**: Enables granular logging of specific events occurring during or related to platform-mediated calls for drivers.
            - **Endpoint**: `POST /v2/ui/callEvent`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId` - though handler seems to ignore these directly, implying context is in `CallEventReq` or inferred by domain logic).
            - **Authentication**: Requires `TokenAuth` (driver session).
            - **Request Body**: `DCE.CallEventReq` (from `Domain.Action.UI.CallEvent`), containing call identifier, event type (e.g., "CALL_ANSWERED", "DTMF_INPUT"), timestamp, and associated event data.
            - **Response Type**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `logCallEvent` delegates to `Domain.Action.UI.CallEvent.logCallEvent`.
            - **Logic**: The domain action validates and stores the call event data, linking it to the relevant call session for detailed analytics, troubleshooting, and audit purposes.
        - **Organization Administrator Profile Management (`API.UI.OrgAdmin.hs`)** (Source file):
            - **Purpose**: Provides profile management (get/update) for Organization Administrators.
            - **Endpoints (likely under `/v2/ui/orgAdmin/profile`)**:
                - `GET /profile`: Fetches the authenticated Org Admin's profile.
                - `POST /profile`: Updates the authenticated Org Admin's profile.
            - **Authentication**: Requires `AdminTokenAuth` (provides authenticated admin's `SP.Person` context, distinct from driver `TokenAuth`).
            - **Request/Response Types**:
                - `GET`: Returns `DOrgAdmin.OrgAdminProfileRes`.
                - `POST`: Takes `DOrgAdmin.UpdateOrgAdminProfileReq`; returns `DOrgAdmin.UpdateOrgAdminProfileRes`.
            - **Delegation**: Handlers `getProfile` and `updateProfile` delegate to `Domain.Action.UI.OrgAdmin.getProfile` and `Domain.Action.UI.OrgAdmin.updateProfile` respectively.
            - **Logic**: Domain actions retrieve or update the administrator's `Person` record in the database.
        - **Driver Submits Feedback for Ride (`API.UI.Rating.hs`)** (Source file):
            - **Purpose**: Enables authenticated drivers to submit ratings and comments for completed rides.
            - **Endpoint**: `POST /v2/ui/feedback/rateRide`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Request Body**: `CallBAPInternal.FeedbackReq` (likely containing `rating`, `rideId`/`bookingId`, `comments`, `feedbackCategoryIds`).
            - **Response Type**: `Kernel.Types.APISuccess.APISuccess`.
            - **Delegation**: Handler `rating` delegates to `Domain.Action.UI.Rating.rating`.
            - **Logic**: The domain action validates the feedback against the ride and driver, then stores the rating and comments in the database, associating it with the ride and rider.
        - **Driver Cancellation Reasons Retrieval (`API.UI.CancellationReason.hs`)** (Source file):
            - **Purpose**: Provides drivers with a list of standardized cancellation reasons.
            - **Endpoint**: `GET /v2/ui/cancellationReason/list`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`). Note: Handler `list _` suggests context might not be directly used by the handler itself, and domain logic might infer or use general reasons.
            - **Response Type**: `[DCancellationReason.CancellationReasonAPIEntity]` (list of cancellation reason objects, each with code, display text, etc.).
            - **Delegation**: Handler `list` delegates to `Domain.Action.UI.CancellationReason.list`.
            - **Logic**: The domain action fetches predefined cancellation reasons from a configuration source or database.
        - **Driver Fetches Associated Transporter/Merchant Details (`API.UI.Transporter.hs`)** (Source file):
            - **Purpose**: Allows authenticated drivers to fetch details about their associated transporter/merchant.
            - **Endpoint**: `GET /v2/ui/transporter`.
            - **Authentication**: Requires `TokenAuth` (driver session context: `PersonId`, `MerchantId`, `MerchantOperatingCityId`).
            - **Response Type**: `DTransporter.TransporterRec` (containing details like name, contact, policies of the transporter/merchant).
            - **Delegation**: Handler `getTransporter` delegates to `Domain.Action.UI.Transporter.getTransporter`.
            - **Logic**: The domain action uses the `MerchantId` and `MerchantOperatingCityId` from the driver's session context to query the database and retrieve the transporter/merchant entity details.

- **Beckn Integration (Platform Wide)**:
    - // ... (existing content, ensure ACL modules for Select/OnSelect are mentioned) ...
// ... (all other existing sections like External Service Integrations, Metrics Collection etc. should be preserved) ...

## Key Dependencies and Integrations (from `flake.nix` and package files)
// ... (existing content, if dynamic-offer-driver-app introduces new high-level dependencies not already listed, add them here) ...

## Project Structure (High-Level)
// ... (existing content) ...

_This document will be updated with more detailed patterns as individual services and libraries are analyzed._