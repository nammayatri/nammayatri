# System Patterns

## System Architecture
- Microservices architecture.
- The system consists of the following sub-projects:
  - rider-app: A mobile application for riders to request and manage rides.
  - alchemist: A code generation tool for the NammaYatri platform.
  - beckn-cli: A command-line interface for interacting with the Beckn network.
  - dynamic-offer-driver-drainer: A service for draining dynamic offer drivers.
  - dynamic-offer-driver-app/Main: The main application logic for the dynamic offer driver app.
  - dynamic-offer-driver-app/Allocator: The offer allocation logic for the dynamic offer driver app.
  - rider-app-drainer: A service for draining rider app users.
  - rider-app/Main: The main application logic for the rider app.
  - rider-app/Scheduler: Scheduling functionality for the rider app.
  - rider-app/search-result-aggregator: A service for aggregating search results for the rider app.

## Key Technical Decisions
- Using React for the frontend.
- Using Rust for the backend.
- Using PostgreSQL for the database.
- Using Haskell for backend services.
- Using Nix for reproducible builds.
- Using Redis for caching and session management.
- Using Kubernetes for orchestration.
- Using AWS for cloud infrastructure.

## Design Patterns in Use
- Functional programming.
- Dependency injection.

## Mock Google
- Simulates Google Maps APIs (Place Name, Snap to Road, Distance Matrix, Directions).
- Uses mock data for responses.

## Component Relationships
- The frontend communicates with the backend via REST APIs.
- The backend interacts with the database using an ORM.

## Critical Implementation Paths
- User authentication and authorization.
- Ride request and dispatch.

## File Structure Conventions
- `src/` and `src-read-only/` have the same structure; one is manually written, and the other is auto-generated by Namma DSL `.yaml`. A module may be present in both.
- For a Module:
    - API endpoint: `API/**/Module.hs`
    - API Type: `Domain/Types/**/Module.hs`
    - API Handler: `Domain/Action/**/Module.hs`
- Storage Layer:
    - DB Types: `Storage/Beam/Module.hs`
    - DB Queries: `Storage/Queries/Module.hs`
    - DB Cached Queries: `Storage/CachedQueries/Module.hs`
    - DB Graphql Queries: `Storage/GraphqlQueries/Module.hs`
