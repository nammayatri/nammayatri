imports:
  Merchant: Domain.Types.Merchant
  MerchantOperatingCity: Domain.Types.MerchantOperatingCity
  SharedBooking: Domain.Types.SharedBooking
  Ride: Domain.Types.Ride
  Person: Domain.Types.Person
  BaseUrl: Kernel.Types.Common
  VehicleVariant: Domain.Types.VehicleVariant
  ServiceTierType: Domain.Types.ServiceTierType
  Value: Data.Aeson
  HighPrecDistance: Kernel.Types.Common
  HighPrecMoney: Kernel.Types.Common
  parseBaseUrl: Kernel.Prelude
  showBaseUrl: Kernel.Prelude

SharedRide:
  tableName: shared_ride
  derives: "Generic,Show"

  fields:
    id: Id SharedRide
    sharedBookingId: Id SharedBooking
    rideIds: "[Id Ride]"
    bppSharedRideId: Text
    status: SharedRideStatus
    merchantId: Id Merchant
    merchantOperatingCityId: Id MerchantOperatingCity
    driverId: Id Person
    vehicleNumber: Text
    vehicleModel: Text
    vehicleVariant: VehicleVariant|NoRelation
    vehicleServiceTierType: Maybe ServiceTierType|NoRelation
    waypoints: Value
    trackingUrl: Maybe BaseUrl
    totalFare: Maybe HighPrecMoney
    chargeableDistanceValue: Maybe HighPrecDistance
    traveledDistanceValue: Maybe HighPrecDistance
    rideStartTime: Maybe UTCTime
    rideEndTime: Maybe UTCTime
    createdAt: UTCTime
    updatedAt: UTCTime

  constraints:
    id: PrimaryKey
    sharedBookingId: SecondaryKey

  beamType:
    trackingUrl: Maybe Text

  toTType:
    trackingUrl: (Kernel.Prelude.fmap showBaseUrl)|I

  fromTType:
    trackingUrl: (Kernel.Prelude.mapM parseBaseUrl)|MI

  sqlType:
    sharedBookingId: uuid
    rideIds: "uuid[]"
    bppSharedRideId: text
    status: character varying(255)
    merchantId: character varying(36)
    merchantOperatingCityId: character varying(36)
    driverId: character varying(36)
    vehicleNumber: character varying(255)
    vehicleModel: character varying(255)
    vehicleVariant: character varying(60)
    vehicleServiceTierType: character varying(255)
    waypoints: jsonb
    trackingUrl: character varying(255)
    totalFare: numeric(30,10)
    chargeableDistanceValue: double precision
    traveledDistanceValue: double precision
    rideStartTime: timestamptz
    rideEndTime: timestamptz
    createdAt: timestamptz
    updatedAt: timestamptz

  queries:
    findBySharedBookingId:
      kvFunction: findOneWithKV
      where: sharedBookingId

    updateStatus:
      kvFunction: updateOneWithKV
      params: [status, updatedAt]
      where: id

    updateRideStartTime:
      kvFunction: updateOneWithKV
      params: [rideStartTime, updatedAt]
      where: id

    updateRideEndTime:
      kvFunction: updateOneWithKV
      params: [rideEndTime, updatedAt]
      where: id

    updateTotalFare:
      kvFunction: updateOneWithKV
      params: [totalFare, updatedAt]
      where: id

    findByDriverId:
      kvFunction: findAllWithKV
      where: driverId

    findByStatus:
      kvFunction: findAllWithKV
      where: status

  types:
    SharedRideStatus:
      enum: "UPCOMING, NEW, INPROGRESS, COMPLETED, CANCELLED"
      derive: "HttpInstance"