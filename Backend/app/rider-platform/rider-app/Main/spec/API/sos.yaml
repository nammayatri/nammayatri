imports:
  Text: Data.Text
  Person: Domain.Types.Person
  Ride: Domain.Types.Ride
  SosType : Safety.Domain.Types.Sos
  SosStatus : Safety.Domain.Types.Sos
  SosState : Safety.Domain.Types.Sos
  Sos : Safety.Domain.Types.Sos
  LatLong : Kernel.External.Maps.Types

module: Sos
types:
  ErssStatusUpdateReq:
    - idSource: Maybe Text
    - idErss: Maybe Text
    - currentStatus: Text
    - statusDesc: Maybe Text
    - comments: Maybe Text
    - lastUpdatedTime: Maybe Int

  ErssStatusUpdateRes:
    - resultCode: Text
    - resultString: Maybe Text
    - errorMsg: Maybe Text
    - message: Maybe Text
    - payLoad: Maybe Text

  SosRes:
    sosId: Id Sos
    externalSOSSuccess: Maybe Bool

  SosDetailsRes:
    sos: Maybe Sos

  SosReq:
    flow: SosType
    rideId: Maybe (Id Ride)
    isRideEnded: Maybe Bool
    sendPNOnPostRideSOS: Maybe Bool
    notifyAllContacts: Maybe Bool
    customerLocation: Maybe LatLong

  SosUpdateReq:
    status: SosStatus
    comment: Maybe Text

  MockSosReq:
    onRide: Maybe Bool
    startDrill: Maybe Bool

  MarkAsSafeReq:
    isMock: Maybe Bool
    isRideEnded: Maybe Bool
    isEndLiveTracking: Maybe Bool
    contacts: Maybe [Text]

  CallPoliceAPI:
    rideId: Id Ride

  SosLocationUpdateReq:
    lat: Double
    lon: Double
    accuracy: Maybe Double

  SosLocationRes:
    lat: Double
    lon: Double
    accuracy: Maybe Double

  SosTrackingRes:
    currentLocation: Maybe SosLocationRes
    sosState: Maybe SosState
    status: SosStatus

  StartTrackingReq:
    contacts: "[Text]"
    durationInMinutes: Int
    customerLocation: Maybe LatLong
    sosId: Maybe (Id Sos)
    externalReferenceId: Maybe Text

  StartTrackingRes:
    sosId: Id Sos
    trackingUrl: Text

  UpdateStateReq:
    sosState: SosState

  UpdateToRideReq:
    rideId: Id Ride

  SosTrackingDetailsRes:
    personName: Text
    mobileNumber: Text

apis:
  # GET /sos/getDetails
  - GET:
      endpoint: /sos/getDetails/{rideId}
      auth: TokenAuth
      params:
        rideId: Id Ride
      response:
        type: API.Types.UI.Sos.SosDetailsRes

  # GET /sos/IvrOutcome
  - GET:
      endpoint: /sos/IvrOutcome
      auth: NoAuth
      query:
        CallSid: Text
        CallFrom: Text
        digits: Text
        CallStatus: Text
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # POST /sos/create
  - POST:
      endpoint: /sos/create
      auth: TokenAuth
      request:
        type: API.Types.UI.Sos.SosReq
      response:
        type: API.Types.UI.Sos.SosRes

  # POST /sos/{sosId}/status
  - POST:
      endpoint: /sos/{sosId}/status
      auth: TokenAuth
      params:
        sosId: Id Sos
      request:
        type: API.Types.UI.Sos.SosUpdateReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # POST /sos/markRideAsSafe/{sosId}
  - POST:
      endpoint: /sos/markRideAsSafe/{sosId}
      auth: TokenAuth
      params:
        sosId: Id Sos
      request:
        type: API.Types.UI.Sos.MarkAsSafeReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # POST /sos/createMockSos
  - POST:
      endpoint: /sos/createMockSos
      auth: TokenAuth
      request:
        type: API.Types.UI.Sos.MockSosReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # # POST /sos/callPolice
  - POST:
      endpoint: /sos/callPolice
      auth: TokenAuth
      request:
        type: API.Types.UI.Sos.CallPoliceAPI
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # POST /sos/{sosId}/updateLocation
  - POST:
      endpoint: /sos/{sosId}/updateLocation
      auth: TokenAuth
      params:
        sosId: Id Sos
      request:
        type: API.Types.UI.Sos.SosLocationUpdateReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # GET /sos/{sosId}/tracking
  - GET:
      endpoint: /sos/{sosId}/tracking
      auth: NoAuth
      params:
        sosId: Id Sos
      response:
        type: API.Types.UI.Sos.SosTrackingRes

  # POST /sos/startTracking
  - POST:
      endpoint: /sos/startTracking
      auth: TokenAuth
      request:
        type: API.Types.UI.Sos.StartTrackingReq
      response:
        type: API.Types.UI.Sos.StartTrackingRes

  # POST /sos/updateState/{sosId}
  - POST:
      endpoint: /sos/updateState/{sosId}
      auth: TokenAuth
      params:
        sosId: Id Sos
      request:
        type: API.Types.UI.Sos.UpdateStateReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # GET /sos/trackingDetails/{sosId}
  - GET:
      endpoint: /sos/trackingDetails/{sosId}
      auth: TokenAuth
      params:
        sosId: Id Sos
      response:
        type: API.Types.UI.Sos.SosTrackingDetailsRes

  # POST /sos/{sosId}/updateToRide
  - POST:
      endpoint: /sos/{sosId}/updateToRide
      auth: TokenAuth
      params:
        sosId: Id Sos
      request:
        type: API.Types.UI.Sos.UpdateToRideReq
      response:
        type: Kernel.Types.APISuccess.APISuccess

  # POST /sos/erss/statusUpdate (NoAuth webhook from C-DAC)
  - POST:
      endpoint: /sos/erss/statusUpdate
      auth: NoAuth
      request:
        type: API.Types.UI.Sos.ErssStatusUpdateReq
      response:
        type: API.Types.UI.Sos.ErssStatusUpdateRes
