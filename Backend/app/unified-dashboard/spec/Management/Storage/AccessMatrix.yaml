imports:
  Role: Domain.Types.Role
  UTCTime: Kernel.Prelude
  Id: Kernel.Types.Id

AccessMatrix:
  tableName: access_matrix
  fields:
    id: Id AccessMatrix
    roleId: Id Role
    serverName: Maybe ServerName
    userActionType: UserActionType
    createdAt: UTCTime
    updatedAt: UTCTime

  excludedFields:
    - merchantId
    - merchantOperatingCityId

  types:
    ServerName:
      enum: "APP_BACKEND,APP_BACKEND_MANAGEMENT,DRIVER_OFFER_BPP,DRIVER_OFFER_BPP_MANAGEMENT,SPECIAL_ZONE,BHARAT_TAXI"
      derive: "FromDhall"

    UserActionType:
      enum: "POST_USER_LOGIN,POST_USER_LOGIN_OTP,POST_USER_LOGIN_VERIFY,POST_USER_ENABLE_2FA,POST_PROVIDER_PERSON_CREATE,GET_MANAGEMENT_ACCESS_MATRIX,GET_MANAGEMENT_MERCHANT_WITH_CITY_LIST,CREATE_MANAGEMENT_MERCHANT_WITH_ADMIN,CREATE_MANAGEMENT_MERCHANT,LIST_MANAGEMENT_MERCHANTS,CHANGE_MANAGEMENT_MERCHANT_ENABLE_STATE,GET_MANAGEMENT_PERSON_LIST,POST_MANAGEMENT_PERSON_ASSIGN_ROLE,POST_MANAGEMENT_PERSON_ASSIGN_MERCHANT_CITY_ACCESS,POST_MANAGEMENT_PERSON_RESET_MERCHANT_ACCESS,POST_MANAGEMENT_PERSON_RESET_MERCHANT_CITY_ACCESS,DELETE_MANAGEMENT_PERSON,POST_MANAGEMENT_PERSON_CHANGE_ENABLED_STATUS,POST_MANAGEMENT_PERSON_CHANGE_EMAIL_BY_ADMIN,POST_MANAGEMENT_PERSON_CHANGE_PASSWORD_BY_ADMIN,POST_MANAGEMENT_PERSON_CHANGE_MOBILE_BY_ADMIN,GET_MANAGEMENT_USER_PROFILE,GET_MANAGEMENT_USER_CURRENT_MERCHANT,POST_MANAGEMENT_USER_CHANGE_PASSWORD,GET_MANAGEMENT_USER_ACCESS_MATRIX,POST_MANAGEMENT_USER_CHANGE_PASSWORD_AFTER_EXPIRY,POST_MANAGEMENT_ROLE_CREATE,POST_MANAGEMENT_ROLE_ASSIGN_ACCESS_LEVEL,GET_MANAGEMENT_ROLE_LIST,GET_MANAGEMENT_TRANSACTION_LIST"
      derive: "HttpInstance"

    ApiAccessLevel:
      serverName: Maybe ServerName
      userActionType: UserActionType
      derive: "Eq,Ord"

  constraints:
    id: PrimaryKey
    roleId: SecondaryKey
    serverName: SecondaryKey
    userActionType: SecondaryKey

  queries:
    findById:
      kvFunction: findOneWithKV
      where: id
    findByRoleIdAndServerAndActionType:
      kvFunction: findOneWithKV
      where:
        and: [roleId, serverName|M, userActionType]
    findAllByRoleId:
      kvFunction: findAllWithKV
      where: roleId
    findAllByRoles:
      kvFunction: findAllWithKV
      where: roleId
