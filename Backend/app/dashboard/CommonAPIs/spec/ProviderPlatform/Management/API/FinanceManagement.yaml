# 1. Subscription Purchase list – track subscription revenue and usage
# 2. Fleet Operator list – fleet operator master data and financials
# 3. Invoice list – invoice metadata and compliance
# All response fields Maybe so missing data does not break the API.

imports:
  Summary: Dashboard.Common
  Driver: Dashboard.Common

module: FinanceManagement

apis:
  # ----- Subscription Purchase -----
  - GET: # SubscriptionPurchaseListAPI
      endpoint: /subscriptionPurchase/list
      query:
        limit: Int
        offset: Int
        from: UTCTime
        to: UTCTime
        status: Text
        driverId: Text
        fleetOperatorId: Text
        amountMin: Text
        amountMax: Text
        subscriptionId: Text
        serviceName: Text
      auth: ApiAuthV2
      response:
        type: SubscriptionPurchaseListRes

  # ----- Fleet Operator -----
  - GET: # FleetOperatorListAPI
      endpoint: /fleetOperator/finance/list
      query:
        limit: Int
        offset: Int
        fleetOperatorId: Text
        from: UTCTime
        to: UTCTime
        settlementStatus: Text
      auth: ApiAuthV2
      response:
        type: FleetOperatorListRes

  # ----- Invoice -----
  - GET: # InvoiceListAPI
      endpoint: /invoice/list
      query:
        limit: Int
        offset: Int
        invoiceId: Text
        from: UTCTime
        to: UTCTime
        invoiceType: Text
        status: Text
      auth: ApiAuthV2
      response:
        type: InvoiceListRes

  # ----- Reconciliation -----
  - GET: # ReconciliationAPI
      endpoint: /reconciliation
      query:
        fromDate: UTCTime
        toDate: UTCTime
        reconciliationType: Text
        limit: Int
        offset: Int
      auth: ApiAuthV2
      response:
        type: ReconciliationRes

  - POST: # ReconciliationTriggerAPI
      endpoint: /reconciliation/trigger
      auth: ApiAuthV2
      request:
        type: ReconciliationTriggerReq
      response:
        type: ReconciliationTriggerRes
      userActionType: ApiAuth DRIVER_OFFER_BPP_MANAGEMENT FINANCE RECONCILIATION_TRIGGER

types:
  # ----- Subscription Purchase -----
  SubscriptionPurchaseListRes:
    - totalItems: Int
    - summary: Summary
    - subscriptions: [SubscriptionPurchaseListItem]
  SubscriptionPurchaseListItem:
    - subscriptionPurchaseId: Maybe Text
    - planName: Maybe Text
    - planType: Maybe Text
    - subscriptionStartDate: Maybe UTCTime
    - subscriptionEndDate: Maybe UTCTime
    - subscriptionStatus: Maybe Text
    - driverId: Maybe Text
    - fleetOperatorId: Maybe Text
    - subscriptionAmount: Maybe HighPrecMoney
    - gstRate: Maybe Double
    - gstAmount: Maybe HighPrecMoney
    - totalSubscriptionValue: Maybe HighPrecMoney
    - totalEntitledValue: Maybe HighPrecMoney
    - utilizedValue: Maybe HighPrecMoney
    - remainingValue: Maybe HighPrecMoney
    - linkedRideIds: [Text]
    - invoiceIds: [Text]
    - createdAt: Maybe UTCTime
    - updatedAt: Maybe UTCTime

  # ----- Fleet Operator -----
  FleetOperatorListRes:
    - totalItems: Int
    - summary: Summary
    - fleetOperators: [FleetOperatorListItem]
  FleetOperatorListItem:
    - fleetOperatorId: Maybe Text
    - legalName: Maybe Text
    - pan: Maybe Text
    - gstin: Maybe Text
    - settlementPreference: Maybe Text
    - linkedDriverIds: [Text]
    - totalEarnings: Maybe HighPrecMoney
    - totalDeductions: Maybe HighPrecMoney
    - outstandingBalance: Maybe HighPrecMoney
    - payoutReference: Maybe Text
    - payoutAmount: Maybe HighPrecMoney
    - payoutStatus: Maybe Text
    - createdAt: Maybe UTCTime
    - updatedAt: Maybe UTCTime

  # ----- Invoice -----
  InvoiceListRes:
    - totalItems: Int
    - summary: Summary
    - invoices: [InvoiceListItem]
  InvoiceListItem:
    - invoiceId: Maybe Text
    - invoiceNumber: Maybe Text
    - invoiceType: Maybe Text
    - invoiceDate: Maybe UTCTime
    - invoiceStatus: Maybe Text
    - counterpartyType: Maybe Text
    - counterpartyId: Maybe Text
    - taxableValue: Maybe HighPrecMoney
    - gstRate: Maybe Double
    - gstAmount: Maybe HighPrecMoney
    - totalInvoiceValue: Maybe HighPrecMoney
    - tdsReference: Maybe Text
    - irn: Maybe Text
    - qrCode: Maybe Text
    - rideId: Maybe Text
    - subscriptionId: Maybe Text
    - generatedAt: Maybe UTCTime

  # ----- Reconciliation -----
  ReconciliationRes:
    - summary: ReconciliationSummary
    - exceptions: [ReconciliationEntry]
    - completed: [ReconciliationEntry]
  ReconciliationSummariesRes:
    - summaries: [ReconciliationSummary]
    - totalCount: Int
  ReconciliationEntriesRes:
    - entries: [ReconciliationEntry]
    - pagination: PaginationInfo
  ReconciliationTriggerReq:
    - fromDate: UTCTime
    - toDate: UTCTime
    - reconciliationType: Maybe Text
  ReconciliationTriggerRes:
    - success: Bool
    - message: Text
  ReconciliationStatusRes:
    - statuses: [ReconciliationStatusItem]
  ReconciliationSummary:
    - totalDiscrepancies: Int
    - matchedRecords: Int
    - matchRate: Text
    - sourceTotal: HighPrecMoney
    - targetTotal: HighPrecMoney
    - varianceAmount: HighPrecMoney
  ReconciliationEntry:
    - bookingId: Maybe Text
    - dcoId: Maybe Text
    - status: Maybe Text
    - mode: Maybe Text
    - expectedDsrValue: Maybe HighPrecMoney
    - actualLedgerValue: Maybe HighPrecMoney
    - variance: Maybe HighPrecMoney
    - reconStatus: Maybe Text
    - mismatchReason: Maybe Text
    - timestamp: Maybe UTCTime
  PaginationInfo:
    - total: Int
    - limit: Int
    - offset: Int
    - hasMore: Bool
  ReconciliationStatusItem:
    - reconciliationType: Text
    - status: Text
    - lastCompletedDate: Maybe UTCTime
    - errorMessage: Maybe Text

extraOperations:
  - EXTRA_API_TYPES_FILE
  - EXTRA_API_COMMON_TYPES_FILE